<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApoioBPO - Sistema de Apoio BPO</title>
    <link rel="icon" type="image/png" href="./images/icone_meta.png">

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style type="text/tailwindcss">
        :root {
            --color-bg: #e0e5ec;
            --color-text: #5a6474;
            --color-shadow-1: #ffffff;
            --color-shadow-2: #a3b1c6;
            --color-accent: #0ea5e9;
            --color-subtle: #9ca3af;
            --scrollbar-thumb: #a3b1c6;
            --scrollbar-thumb-hover: #5a6474;
        }

        html.dark {
            --color-bg: #1f2937;
            --color-text: #d1d9e6;
            --color-shadow-1: #374151;
            --color-shadow-2: #111827;
            --color-accent: #38bdf8;
            --color-subtle: #6b7280;
            --scrollbar-thumb: #5a6474;
            --scrollbar-thumb-hover: #9ca3af;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: background-color 0.35s cubic-bezier(0.4, 0, 0.2, 1), color 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: hidden;
        }

        .neumorphic-outset { box-shadow: 6px 6px 12px var(--color-shadow-2), -6px -6px 12px var(--color-shadow-1); }
        .neumorphic-inset { box-shadow: inset 6px 6px 12px var(--color-shadow-2), inset -6px -6px 12px var(--color-shadow-1); }
        .neumorphic-outset-sm { box-shadow: 3px 3px 6px var(--color-shadow-2), -3px -3px 6px var(--color-shadow-1); }
        
        .text-accent { color: var(--color-accent); }
        .text-subtle { color: var(--color-subtle); }

        ::placeholder { color: #9ca3af; }
        .dark ::placeholder { color: #6b7280; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: var(--scrollbar-thumb); border-radius: 20px; border: 2px solid var(--color-bg); }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: var(--scrollbar-thumb-hover); }

        .toggle-container {
            position: relative;
            width: 3.5rem;
            height: 1.75rem;
        }
        .toggle-label {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 9999px;
            box-shadow: inset 2px 2px 5px var(--color-shadow-2), inset -2px -2px 5px var(--color-shadow-1);
            transition: background-color 0.3s ease;
            cursor: pointer;
        }
        .toggle-checkbox {
            appearance: none;
            position: absolute;
            top: 0.25rem;
            left: 0.25rem;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 9999px;
            background-color: var(--color-bg);
            box-shadow: 2px 2px 4px var(--color-shadow-2), -2px -2px 4px var(--color-shadow-1);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .toggle-checkbox:checked {
            transform: translateX(1.75rem);
            background-color: var(--color-accent);
        }


        @keyframes fade-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        @keyframes fade-out { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.95); } }
        .animate-fade-out { animation: fade-out 0.3s ease-in forwards; }
        
        input, select { background-color: transparent !important; color: var(--color-text); }
        select option { background: var(--color-bg); color: var(--color-text); }

        #dock-slider { transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1); position: absolute; left: 0; margin-left: 0 !important; margin-right: 0 !important; }

        .custom-checkbox { width: 22px; height: 22px; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; transition: all 0.2s ease-in-out; cursor: pointer; }
        .custom-checkbox .check-icon { opacity: 0; transform: scale(0.5); transition: all 0.2s ease-in-out; color: var(--color-accent); }
        .checklist-item-checkbox:checked + .custom-checkbox { box-shadow: inset 3px 3px 6px var(--color-shadow-2), inset -3px -3px 6px var(--color-shadow-1); }
        .checklist-item-checkbox:checked + .custom-checkbox .check-icon { opacity: 1; transform: scale(1); }
        .checklist-list-item:has(.checklist-item-checkbox:checked) { background-color: rgba(0,0,0,0.02); }
        html.dark .checklist-list-item:has(.checklist-item-checkbox:checked) { background-color: rgba(255,255,255,0.02); }
        
        .pagination-dot { width: 10px; height: 10px; border-radius: 50%; transition: all 0.3s ease; background-color: var(--color-text); opacity: 0.3; }
        .pagination-dot.active { opacity: 1; transform: scale(1.2); background-color: var(--color-accent); }
        
        @keyframes image-fade-in { from { opacity: 0.4; } to { opacity: 1; } }
        .image-viewer-content { animation: image-fade-in 0.5s ease-in-out; }
        
        #terms-modal.hidden, #info-modal.hidden { display: none; }
        #main-content.blurred { filter: blur(5px) saturate(0.9); transform: scale(0.98); pointer-events: none; user-select: none; transition: all 0.3s ease-out; }
        
        #accept-terms-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
        #timer-toggle:checked + .toggle-label {
            background-color: rgba(56, 189, 248, 0.1);
            box-shadow:
                0 0 5px var(--color-accent),
                0 0 10px var(--color-accent),
                0 0 20px var(--color-accent),
                inset 2px 2px 5px var(--color-shadow-2),
                inset -2px -2px 5px var(--color-shadow-1);
        }

    </style>
</head>

<body>
    <!-- MODAL DE TERMOS DE USO -->
    <div id="terms-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-[var(--color-bg)] opacity-90"></div>
        <div class="relative w-full max-w-2xl p-6 sm:p-8 rounded-2xl neumorphic-outset animate-fade-in">
            <h2 class="text-2xl font-bold mb-2 text-accent">Termos e Condições de Uso — ApoioBPO</h2>
            <p class="text-xs text-subtle mb-4">Versão 1.43 — 28/07/2025</p>

            <div class="max-h-[60vh] overflow-y-auto custom-scrollbar pr-4 text-sm space-y-4">
                <p>Bem-vindo ao ApoioBPO. Antes de utilizar o sistema, leia atentamente os termos abaixo. Ao clicar em “Aceitar e Continuar”, você declara estar de acordo com as condições estabelecidas.</p>

                <div>
                    <h3 class="font-semibold text-base mt-4 mb-2">1. Propriedade Intelectual</h3>
                    <p class="text-subtle">Este sistema foi desenvolvido por Wellington Juan Dutra Oliveira (Assistente de BPO), com colaboração de:</p>
                    <ul class="list-disc list-inside pl-4 text-subtle">
                        <li>Gabriel Artur Lopes Feltes (Coordenador de BPO)</li>
                        <li>Mauricio Gabriel Freiberger Konig (Líder de BPO)</li>
                        <li>Erika Mendonça Figueira (Assistente de BPO)</li>
                        <li>Bruno Corrêa Alves (Assistente de BPO)</li> 
                    </ul>
                    <p class="text-subtle mt-2">Todos os direitos sobre o sistema, incluindo design, código-fonte, funcionalidades e estrutura lógica, são reservados ao autor.</p>
                </div>

                <div>
                    <h3 class="font-semibold text-base mt-4 mb-2">2. Finalidade de Uso</h3>
                    <p class="text-subtle">O ApoioBPO é destinado exclusivamente para uso interno e profissional pelos colaboradores da Meta Serviços em Informática S.A., no contexto de serviços de BPO (Business Process Outsourcing) prestados ao Banco Cooperativo Sicoob S.A.</p>
                    <p class="text-subtle mt-2">Funcionalidades abrangidas:</p>
                    <ul class="list-disc list-inside pl-4 text-subtle">
                        <li>Consulta e verificação de CNPJ;</li>
                        <li>Cálculo de renda para pessoas físicas (PF) e jurídicas (PJ);</li>
                        <li>Módulo de contador, regras automatizadas e pareceres técnicos;</li>
                        <li>Checklist de documentos.</li>
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold text-base mt-4 mb-2">3. Restrições de Uso</h3>
                    <p class="text-subtle">É terminantemente proibido:</p>
                    <ul class="list-disc list-inside pl-4 text-subtle">
                        <li>Copiar, modificar, vender, alugar ou distribuir o sistema sem autorização expressa dos autores;</li>
                        <li>Utilizar o sistema fora do escopo profissional definido neste Termo;</li>
                        <li>Compartilhar o acesso com pessoas não autorizadas.</li>
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold text-base mt-4 mb-2">4. Confidencialidade</h3>
                    <p class="text-subtle">Todas as informações processadas, visualizadas ou geradas pelo sistema, incluindo dados de clientes, cálculos, pareceres, regras de negócio e checklists, são estritamente confidenciais. O usuário se compromete a protegê-las contra acesso, uso ou divulgação não autorizados, mesmo após o término do vínculo com a organização. É vedado copiar, armazenar externamente ou transmitir qualquer dado sem permissão expressa e documentada.</p>
                </div>

                <div>
                    <h3 class="font-semibold text-base mt-4 mb-2">5. Responsabilidade Limitada</h3>
                    <p class="text-subtle">O sistema é fornecido com o compromisso de entrega técnica adequada às funcionalidades descritas neste termo. Ainda assim, podem existir limitações técnicas ou operacionais decorrentes de atualizações, integrações externas, indisponibilidades de terceiros ou uso indevido. Os desenvolvedores e colaboradores assumem responsabilidade limitada, restrita ao correto funcionamento das funcionalidades tal como especificadas.</p>
                    <p class="text-subtle mt-2">Decisões operacionais, financeiras ou jurídicas tomadas com base em informações do sistema devem ser validadas pelo usuário. Eventuais falhas devem ser comunicadas imediatamente pelos canais oficiais de suporte descritos na Cláusula 6, para avaliação e correção.</p>
                </div>

                <div>
                    <h3 class="font-semibold text-base mt-4 mb-2">6. Suporte e Comunicação de Incidentes</h3>
                    <p class="text-subtle">Em caso de falhas, inconsistências, dúvidas ou incidentes de segurança, o usuário deve reportar imediatamente por meio do canal oficial interno de suporte da Meta Serviços em Informática S.A. (ex.: Microsoft Teams, E-mail corporativo ou ferramenta designada pela empresa). O não reporte tempestivo pode limitar a responsabilidade dos autores quanto aos efeitos decorrentes.</p>
                </div>

                <div>
                    <h3 class="font-semibold text-base mt-4 mb-2">7. Vigência e Atualizações</h3>
                    <p class="text-subtle">Estes Termos de Uso entram em vigor na data indicada na versão e poderão ser atualizados a qualquer tempo, por necessidade técnica, jurídica ou operacional. É responsabilidade do usuário manter-se informado sobre a versão vigente, exibida no topo deste documento.</p>
                </div>

            </div>
            <div class="mt-6 space-y-4">
                <label for="terms-checkbox" class="flex items-center justify-center gap-2 text-sm cursor-pointer">
                    <input type="checkbox" id="terms-checkbox" class="h-4 w-4 rounded border-gray-300 text-accent focus:ring-accent">
                    <span>Declaro que li, compreendi e aceito todos os termos e condições de uso descritos acima</span>
                </label>
                <button id="accept-terms-btn" class="w-full px-8 py-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 text-accent" disabled>
                    Aceitar e Continuar
                </button>
            </div>
        </div>
    </div>


    <div id="main-content" class="min-h-screen w-full flex flex-col items-center p-4 sm:p-8 transition-all duration-300">

        <main class="w-full max-w-5xl mx-auto flex flex-col gap-4 mb-24">
            <header class="flex justify-between items-center w-full px-2 flex-shrink-0">
                <h1 id="module-title" class="text-2xl font-bold transition-all duration-300"></h1>
                <div class="flex items-center gap-2">
                    <button id="info-button" class="p-3 rounded-full neumorphic-outset-sm transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">
                        <i data-lucide="info" class="w-5 h-5"></i>
                    </button>
                    <button id="theme-toggle" class="p-3 rounded-full neumorphic-outset-sm transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">
                        <i data-lucide="sun" id="sun-icon" class="w-5 h-5"></i>
                        <i data-lucide="moon" id="moon-icon" class="hidden w-5 h-5"></i>
                    </button>
                </div>
            </header>

            <div id="module-container" class="w-full p-6 md:p-8 rounded-2xl neumorphic-outset min-h-[60vh]">
                <div id="faturamento-module" class="module-content hidden">
                    <div class="flex mb-6 border-b border-slate-300 dark:border-slate-600 flex-shrink-0 overflow-x-auto">
                        <button class="faturamento-tab-button py-2 px-4 font-semibold whitespace-nowrap" data-tab="calculo-simples">Cálculo do Simples</button>
                        <button class="faturamento-tab-button py-2 px-4 font-semibold text-subtle whitespace-nowrap" data-tab="rel-faturamento">Rel. Faturamento</button>
                        <button class="faturamento-tab-button py-2 px-4 font-semibold text-subtle whitespace-nowrap" data-tab="semoventes">Semoventes</button>
                        <button class="faturamento-tab-button py-2 px-4 font-semibold text-subtle whitespace-nowrap" data-tab="nfs">NF's</button>
                        <button class="faturamento-tab-button py-2 px-4 font-semibold text-subtle whitespace-nowrap" data-tab="quotas">Quotas</button>
                        <button class="faturamento-tab-button py-2 px-4 font-semibold text-subtle whitespace-nowrap" data-tab="fcpr">FCPR</button>
                    </div>
                    <div>
                        <div id="calculo-simples-tab" class="faturamento-tab-content">
                             <form id="faturamento-form" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                <div class="flex flex-col gap-2">
                                    <label for="rbt12" class="text-sm font-medium">Receita Bruta 12 Meses (RBT12)</label>
                                    <input type="text" inputmode="decimal" id="rbt12" placeholder="0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                                </div>
                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-medium">1º Cálculo (Somente RBT12)</label>
                                    <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                        <p id="resultado1" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                    </div>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <label for="rpa" class="text-sm font-medium">Receita Bruta do Período (RPA)</label>
                                    <input type="text" inputmode="decimal" id="rpa" placeholder="0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                                </div>
                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-medium">2º Cálculo (+12 Meses)</label>
                                    <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                        <p id="resultado2" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                    </div>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <label for="mes_anterior" class="text-sm font-medium">Redução Mês Ano Anterior</label>
                                    <input type="text" inputmode="decimal" id="mes_anterior" placeholder="0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                                </div>
                                 <div class="flex flex-col gap-2">
                                    <label class="text-sm font-medium">3º Cálculo (&lt;12 Meses)</label>
                                    <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                        <p id="resultado3" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                    </div>
                                </div>

                                <div class="flex flex-col gap-2">
                                    <label for="num_meses" class="text-sm font-medium">Quantidade de Meses (&lt; 12)</label>
                                    <input type="number" id="num_meses" placeholder="1" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                                </div>
                                
                                <div></div>

                                <div class="md:col-span-2 flex gap-4 mt-4">
                                    <button id="calcular-faturamento" type="button" class="flex-1 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                        <i data-lucide="calculator" class="w-5 h-5"></i> Calcular
                                    </button>
                                    <button id="limpar-faturamento" type="button" class="flex-1 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i> Limpar
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div id="rel-faturamento-tab" class="faturamento-tab-content hidden">
                           <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                <div class="flex flex-col gap-2">
                                    <h3 class="text-lg font-semibold mb-2">Valores Mensais</h3>
                                    <div id="rel-faturamento-inputs" class="space-y-2">
                                        <!-- Inputs serão gerados pelo JS -->
                                    </div>
                                </div>
                                <div class="flex flex-col gap-4">
                                    <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Renda 12 Meses</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="rel-faturamento-renda-12-meses" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Renda Mensal</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="rel-faturamento-renda-mensal" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                    <button id="rel-faturamento-limpar" type="button" class="mt-4 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i> Limpar
                                    </button>
                                </div>
                           </div>
                        </div>
                        <div id="semoventes-tab" class="faturamento-tab-content hidden">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div class="lg:col-span-2">
                                    <h3 class="text-lg font-semibold mb-4">Rebanho</h3>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead class="border-b-2 border-slate-300 dark:border-slate-600">
                                                <tr>
                                                    <th class="p-2 text-left">Descrição</th>
                                                    <th class="p-2 text-left">Quantidade</th>
                                                    <th class="p-2 text-left">Valor Unitário</th>
                                                    <th class="p-2 text-left">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody id="semoventes-tbody">
                                                <!-- Linhas geradas por JS -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-4">
                                    <h3 class="text-lg font-semibold">Resultados</h3>
                                     <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Quantidade Total</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="semoventes-qtd-total" class="text-2xl font-bold text-accent">0</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Renda Anual</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="semoventes-renda-anual" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Renda Mensal</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="semoventes-renda-mensal" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                    <button id="semoventes-limpar" type="button" class="mt-4 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i> Limpar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="nfs-tab" class="faturamento-tab-content hidden">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div class="lg:col-span-2">
                                    <h3 class="text-lg font-semibold mb-4">Notas Fiscais</h3>
                                    <div id="nfs-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-x-4 gap-y-2 max-h-[40vh] overflow-y-auto custom-scrollbar pr-2">
                                        <!-- Inputs gerados por JS -->
                                    </div>
                                </div>
                                <div class="flex flex-col gap-4">
                                    <h3 class="text-lg font-semibold">Cálculo</h3>
                                    <div class="flex flex-col gap-2">
                                        <label for="nfs-propriedade" class="text-sm font-medium">Propriedade (%)</label>
                                        <input type="text" inputmode="decimal" id="nfs-propriedade" value="100" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Renda Anual</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="nfs-renda-anual" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Renda Mensal</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="nfs-renda-mensal" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                    <button id="nfs-limpar" type="button" class="mt-4 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i> Limpar
                                    </button>
                                </div>
                            </div>
                        </div>
                         <div id="quotas-tab" class="faturamento-tab-content hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="space-y-4 p-4 rounded-2xl neumorphic-inset">
                                    <h3 class="text-lg font-semibold text-center">Calcular % por Valor</h3>
                                    <div class="flex flex-col gap-2">
                                        <label for="quotas-valor-total-empresa-1" class="text-sm font-medium">Valor total das quotas da empresa</label>
                                        <input type="text" inputmode="decimal" id="quotas-valor-total-empresa-1" placeholder="R$ 0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label for="quotas-valor-associado-1" class="text-sm font-medium">Valor monetário das quotas do associado</label>
                                        <input type="text" inputmode="decimal" id="quotas-valor-associado-1" placeholder="R$ 0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    </div>
                                    <div class="flex flex-col gap-2 mt-2">
                                        <label class="text-sm font-medium">% Percentual Propriedade do Associado</label>
                                        <div class="p-3 rounded-2xl neumorphic-inset min-h-[44px] flex items-center">
                                            <p id="quotas-percentual-resultado" class="font-bold text-accent">0.00%</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="space-y-4 p-4 rounded-2xl neumorphic-inset">
                                    <h3 class="text-lg font-semibold text-center">Calcular Valor por %</h3>
                                    <div class="flex flex-col gap-2">
                                        <label for="quotas-valor-total-empresa-2" class="text-sm font-medium">Valor total das quotas da empresa</label>
                                        <input type="text" inputmode="decimal" id="quotas-valor-total-empresa-2" placeholder="R$ 0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label for="quotas-percentual-associado-2" class="text-sm font-medium">% Percentual Propriedade do Associado</label>
                                        <input type="text" inputmode="decimal" id="quotas-percentual-associado-2" placeholder="0,00%" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    </div>
                                    <div class="flex flex-col gap-2 mt-2">
                                        <label class="text-sm font-medium">Valor monetário das quotas do associado</label>
                                        <div class="p-3 rounded-2xl neumorphic-inset min-h-[44px] flex items-center">
                                            <p id="quotas-valor-resultado" class="font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="md:col-span-2">
                                     <button id="quotas-limpar" type="button" class="w-full mt-4 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i> Limpar
                                    </button>
                                </div>
                            </div>
                        </div>
                         <div id="fcpr-tab" class="faturamento-tab-content hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                <div class="flex flex-col gap-2">
                                    <h3 class="text-lg font-semibold mb-2">Renda Agrícola & Agropecuária</h3>
                                    <div id="fcpr-inputs" class="space-y-2">
                                        <!-- Inputs serão gerados pelo JS -->
                                    </div>
                                </div>
                                <div class="flex flex-col gap-4">
                                    <h3 class="text-lg font-semibold">Percentual Propriedade / Período</h3>
                                    <div class="flex flex-col gap-2">
                                        <label for="fcpr-percentual" class="text-sm font-medium">Percentual (%)</label>
                                        <input type="text" inputmode="decimal" id="fcpr-percentual" value="100" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label for="fcpr-meses" class="text-sm font-medium">Meses</label>
                                        <input type="number" id="fcpr-meses" value="12" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Renda Anual</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="fcpr-renda-anual" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <label class="text-sm font-medium">Renda Mensal</label>
                                        <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                            <p id="fcpr-renda-mensal" class="text-2xl font-bold text-accent">R$ 0,00</p>
                                        </div>
                                    </div>
                                    <button id="fcpr-limpar" type="button" class="mt-4 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i> Limpar
                                    </button>
                                </div>
                           </div>
                        </div>
                    </div>
                </div>

                <div id="renda-pf-module" class="module-content hidden">
                    <div class="flex mb-6 border-b border-slate-300 dark:border-slate-600 flex-shrink-0">
                        <button class="renda-pf-tab-button py-2 px-4 font-semibold" data-tab="calculadora">Calculadora</button>
                        <button class="renda-pf-tab-button py-2 px-4 font-semibold text-subtle" data-tab="media">Média de Holerites</button>
                        <button class="renda-pf-tab-button py-2 px-4 font-semibold text-subtle" data-tab="soma">Soma de Valores</button>
                    </div>
                    <div>
                        <div id="calculadora-tab" class="renda-pf-tab-content">
                           <h3 class="text-2xl font-bold mb-6">Calculadora Simples</h3>
                           <div class="flex flex-col gap-6">
                               <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 items-end">
                                   <input type="text" inputmode="decimal" id="valor_sisbr" placeholder="0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-full">
                                   <div class="p-4 rounded-2xl neumorphic-inset">
                                       <p class="text-sm text-subtle uppercase tracking-wide">Multiplicado por 12</p>
                                       <p id="sisbr_mult" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                   </div>
                               </div>
                               <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 items-stretch">
                                   <button id="limpar_sisbr" type="button" class="h-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">Limpar</button>
                                   <div class="p-4 rounded-2xl neumorphic-inset">
                                       <p class="text-sm text-subtle uppercase tracking-wide">Dividido por 12</p>
                                       <p id="sisbr_div" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                   </div>
                               </div>
                           </div>
                        </div>
                        <div id="media-tab" class="renda-pf-tab-content hidden">
                            <h3 class="text-2xl font-bold mb-6">Média de Holerites</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                <div class="flex flex-col gap-4">
                                    <h4 class="text-sm text-subtle uppercase tracking-wide">Valores</h4>
                                    <input type="text" inputmode="decimal" placeholder="Valor 1" class="media-holerite-input w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    <input type="text" inputmode="decimal" placeholder="Valor 2" class="media-holerite-input w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    <input type="text" inputmode="decimal" placeholder="Valor 3" class="media-holerite-input w-full bg-transparent p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                </div>
                                <div class="flex flex-col gap-4">
                                    <h4 class="text-sm text-subtle uppercase tracking-wide">Resultado</h4>
                                    <div class="p-4 rounded-2xl neumorphic-inset">
                                        <p class="text-sm font-medium">Média dos Valores</p>
                                        <p id="media_resultado" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                    </div>
                                    <button id="limpar_media" type="button" class="mt-2 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">Limpar</button>
                                </div>
                            </div>
                        </div>
                        <div id="soma-tab" class="renda-pf-tab-content hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                <div class="flex flex-col gap-2">
                                    <h4 class="text-sm text-subtle uppercase tracking-wide mb-2">Valores a Somar</h4>
                                    <div id="soma-inputs-container" class="flex flex-col gap-2">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    </div>
                                </div>
                                <div class="flex flex-col gap-2">
                                    <h4 class="text-sm text-subtle uppercase tracking-wide mb-2">Valores a Subtrair</h4>
                                    <div id="sub-inputs-container" class="flex flex-col gap-2">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    </div>
                                </div>
                                <div class="md:col-span-2 flex flex-col md:flex-row gap-4 mt-4">
                                     <div class="flex-1 p-4 rounded-2xl neumorphic-inset">
                                         <p class="text-sm font-medium">Soma Total</p>
                                         <p id="soma_total_resultado" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                     </div>
                                     <div class="flex-1 p-4 rounded-2xl neumorphic-inset">
                                         <p class="text-sm font-medium">Divisão por 12</p>
                                         <p id="soma_div12_resultado" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                     </div>
                                </div>
                                <div class="md:col-span-2 mt-4">
                                    <button id="limpar_soma" type="button" class="w-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">Limpar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="regras-module" class="module-content hidden">
                    <h2 class="text-2xl font-bold mb-6">Regras do Imposto de Renda</h2>
                    <div class="overflow-auto custom-scrollbar">
                        <table class="w-full text-left text-sm">
                            <thead class="border-b-2 border-slate-300 dark:border-slate-600 sticky top-0 bg-[var(--color-bg)]">
                                <tr>
                                    <th class="p-2">Item</th>
                                    <th class="p-2">Referência</th>
                                    <th class="p-2">Tipo de Renda Aceito</th>
                                </tr>
                            </thead>
                            <tbody id="regras-irpf-tbody">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div id="cnpj-module" class="module-content hidden">
                    <h3 class="text-2xl font-bold mb-6">Consultar CNPJ</h3>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <input type="text" id="cnpj-input" placeholder="00.000.000/0000-00" class="flex-grow p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                        <button id="consultar-cnpj" class="p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                            <i data-lucide="search" class="w-5 h-5"></i> Consultar
                        </button>
                        <button id="limpar-cnpj" class="p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                            <i data-lucide="x" class="w-5 h-5"></i> Limpar
                        </button>
                    </div>
                    <div id="cnpj-results-container" class="mt-6">
                        </div>
                </div>

                <div id="parecer-module" class="module-content hidden flex flex-col">
                    <div class="flex flex-col sm:flex-row items-center mb-6 gap-4 flex-shrink-0">
                        <div class="relative flex-grow w-full">
                            <input type="text" id="searchInput" placeholder="Pesquisar pareceres por tipo ou descrição..." class="w-full p-3 pr-12 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                            <i data-lucide="search" class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-subtle"></i>
                        </div>
                        <div class="w-full sm:w-auto">
                            <select id="parecer-category-filter" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                </select>
                        </div>
                    </div>
                    <div id="pareceresContainer" class="space-y-4 overflow-auto custom-scrollbar flex-grow">
                        </div>
                </div>
                <div id="contador-module" class="module-content hidden h-full">
                     <div class="grid md:grid-cols-2 gap-8 items-center h-full">
                        <div id="counters-grid" class="grid grid-cols-1 sm:grid-cols-2 grid-rows-2 gap-6 h-full min-h-[300px]">
                           </div>
                        <div class="flex flex-col gap-6 p-6 rounded-2xl neumorphic-inset">
                            <h3 class="text-sm text-subtle uppercase tracking-wide">Settings</h3>
                            <div class="flex items-center justify-between">
                                <label for="timer-toggle" class="font-medium">Timer Mode</label>
                                <div class="toggle-container">
                                    <input type="checkbox" name="toggle" id="timer-toggle" class="toggle-checkbox"/>
                                    <label for="timer-toggle" class="toggle-label"></label>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2">
                                <label for="increment-by-input" class="text-sm font-medium">Increment By</label>
                                <input type="number" id="increment-by-input" value="1" class="w-full bg-transparent p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                            </div>
                            <div class="flex flex-col gap-2">
                                <label for="counter-start-input" class="text-sm font-medium">Start Value</label>
                                <input type="number" id="counter-start-input" value="0" class="w-full bg-transparent p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                            </div>
                             <button id="add-counter-btn" class="w-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                <i data-lucide="plus-circle" class="w-5 h-5"></i> Add Counter
                            </button>
                             <button id="contador-reset" class="w-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                <i data-lucide="rotate-cw" class="w-5 h-5"></i> Reset All
                            </button>
                        </div>
                     </div>
                </div>

                <div id="checklist-module" class="module-content hidden flex flex-col gap-4 h-full">
                    </div>
            </div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 p-4 w-full flex justify-center">
            <div id="dock-container" class="relative flex items-center justify-start rounded-full neumorphic-outset overflow-x-auto max-w-full py-1">
                <div id="dock-slider" class="absolute top-0 bottom-0 rounded-full neumorphic-inset"></div>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="faturamento-module" data-title="Cálculo Renda PJ">Renda PJ</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="renda-pf-module" data-title="Cálculo Renda PF">Renda PF</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="cnpj-module" data-title="Consulta CNPJ">Consulta CNPJ</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="contador-module" data-title="Contador">Contador</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="regras-module" data-title="Regras IRPF">Regras</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="parecer-module" data-title="Pareceres">Pareceres</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="checklist-module" data-title="Checklist">Checklist</button>
            </div>
        </nav>
    </div>

    <!-- MODAL DE INFORMAÇÕES (CRÉDITOS) -->
    <div id="info-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="modal-overlay absolute inset-0 bg-[var(--color-bg)] opacity-80"></div>
        <div class="modal-content relative w-full max-w-lg p-6 rounded-2xl neumorphic-outset animate-fade-in">
            <button class="modal-close-btn absolute top-4 right-4 p-2 rounded-full neumorphic-outset-sm transition-all duration-200 active:scale-95 hover:bg-black/10 dark:hover:bg-white/10">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <h2 class="text-2xl font-bold mb-4 text-accent">Créditos e Uso</h2>
            <div class="text-sm space-y-3">
                <p><strong>Desenvolvido por:</strong> Wellington Juan Dutra Oliveira</p>
                <p><strong>Com colaboração de:</strong></p>
                <ul class="list-disc list-inside pl-4 text-subtle">
                    <li>Gabriel Artur Lopes Feltes (Coordenador de BPO)</li>
                    <li>Mauricio Gabriel Freiberger Konig (Líder de BPO)</li>
                    <li>Erika Mendonça Figueira (Assistente de BPO)</li>
                    <li>Bruno Corrêa Alves (Assistente de BPO)</li>
                </ul>
                <p><strong>Lembrete de Uso:</strong></p>
                <p class="text-subtle">Esta ferramenta é de uso exclusivo para colaboradores da Meta Serviços em Informática S.A. a serviço do Sicoob. É proibida a cópia, distribuição ou uso fora do âmbito profissional designado.</p>
                <p class="text-xs text-center text-subtle pt-4 mt-4 border-t border-[var(--color-shadow-2)]">© 2025 Wellington Juan Dutra Oliveira e colaboradores. Todos os direitos reservados.</p>
            </div>
        </div>
    </div>

    <template id="counter-template">
        <div class="counter-card p-4 rounded-2xl neumorphic-inset flex flex-col items-center justify-center gap-4 relative h-full">
            <button class="remove-counter-btn absolute top-2 right-2 p-1 rounded-full hover:bg-black/10 dark:hover:bg-white/10">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
            <h4 class="counter-title font-semibold text-center w-full px-4 truncate" contenteditable="true">Contador</h4>
            <span class="counter-display font-bold text-7xl text-accent cursor-pointer" contenteditable="false">0</span>
            <div class="flex items-center gap-4">
                <button class="counter-minus w-16 h-16 rounded-2xl neumorphic-outset-sm text-3xl font-bold active:scale-95 transition-transform flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5">-</button>
                <button class="counter-plus w-16 h-16 rounded-2xl neumorphic-outset-sm text-3xl font-bold active:scale-95 transition-transform flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5">+</button>
                
                <button class="timer-play w-16 h-16 rounded-2xl neumorphic-outset-sm text-3xl font-bold active:scale-95 transition-transform flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5 hidden"><i data-lucide="play"></i></button>
                <button class="timer-reset w-16 h-16 rounded-2xl neumorphic-outset-sm text-3xl font-bold active:scale-95 transition-transform flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5 hidden"><i data-lucide="rotate-cw"></i></button>
            </div>
        </div>
    </template>

    <script>
        // --- FUNÇÕES GLOBAIS ---
        function copyParecer(text, buttonElement) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = 0;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            if (buttonElement) {
                const icon = buttonElement.querySelector('i');
                const originalIcon = icon.dataset.lucide;
                icon.dataset.lucide = 'check';
                if (typeof lucide !== 'undefined') lucide.createIcons();

                setTimeout(() => {
                    icon.dataset.lucide = originalIcon;
                    if (typeof lucide !== 'undefined') lucide.createIcons();
                }, 1500);
            }
        }

        window.onload = () => {
            // --- SELEÇÃO DOS ELEMENTOS DO DOM ---
            const themeToggleButton = document.getElementById('theme-toggle');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const dockContainer = document.getElementById('dock-container');
            const dockSlider = document.getElementById('dock-slider');
            const dockButtons = document.querySelectorAll('.dock-button');
            const moduleTitle = document.getElementById('module-title');
            const modules = document.querySelectorAll('.module-content');
            const infoButton = document.getElementById('info-button');
            const infoModal = document.getElementById('info-modal');
            const modalOverlay = infoModal.querySelector('.modal-overlay');
            const modalCloseBtn = infoModal.querySelector('.modal-close-btn');

            // --- Elementos do Modal de Termos ---
            const termsModal = document.getElementById('terms-modal');
            const acceptTermsBtn = document.getElementById('accept-terms-btn');
            const termsCheckbox = document.getElementById('terms-checkbox');
            const mainContent = document.getElementById('main-content');


            // --- FUNÇÕES AUXILIARES ---
            function formatCurrency(value) {
                if (isNaN(value) || !isFinite(value)) {
                    return "R$ 0,00";
                }
                return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            }

            function parseLocalFloat(value) {
                return parseFloat(String(value).replace(/\./g, '').replace(',', '.')) || 0;
            }

            function safeCreateIcons() {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }

            // --- LÓGICA DO MODO CLARO/ESCURO ---
            themeToggleButton.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                updateThemeIcons();
            });
            
            function updateThemeIcons() {
                safeCreateIcons();
                const isDarkMode = document.documentElement.classList.contains('dark');
                sunIcon.classList.toggle('hidden', isDarkMode);
                moonIcon.classList.toggle('hidden', !isDarkMode);
            }

            // --- LÓGICA DO MODAL DE INFORMAÇÕES (CRÉDITOS) ---
            infoButton.addEventListener('click', () => {
                infoModal.classList.remove('hidden');
                safeCreateIcons();
            });

            function closeModal() {
                infoModal.classList.add('hidden');
            }

            modalOverlay.addEventListener('click', closeModal);
            modalCloseBtn.addEventListener('click', closeModal);

            // --- LÓGICA DA NAVEGAÇÃO E MÓDULOS ---
            let currentModuleId = null;

            function updateSlider(button) {
                if (!button) return;
                const containerRect = dockContainer.getBoundingClientRect();
                const buttonRect = button.getBoundingClientRect();
                dockSlider.style.width = `${buttonRect.width}px`;
                dockSlider.style.left = `${buttonRect.left - containerRect.left}px`;
                dockButtons.forEach(btn => btn.classList.remove('text-accent', 'font-semibold'));
                button.classList.add('text-accent', 'font-semibold');
            }

            dockButtons.forEach((button) => {
                button.addEventListener('click', () => {
                    const targetModuleId = button.dataset.target;
                    if (targetModuleId === currentModuleId) return;
                    currentModuleId = targetModuleId;
                    
                    const targetTitle = button.dataset.title;
                    updateSlider(button);
                    moduleTitle.textContent = targetTitle;
                    
                    modules.forEach(module => module.classList.add('hidden'));
                    const activeModule = document.getElementById(targetModuleId);
                    if (activeModule) {
                       activeModule.classList.remove('hidden');
                       if (targetModuleId === 'regras-module') renderRegrasTable();
                       if (targetModuleId === 'parecer-module') {
                            populateParecerFilter();
                            filterPareceres();
                       }
                       if (targetModuleId === 'contador-module' && counters.length === 0) {
                           addCounterBtn.click();
                       }
                       if (targetModuleId === 'checklist-module') {
                           renderChecklist();
                       }
                    }
                });
            });
            
            // --- LÓGICA DO MÓDULO DE FATURAMENTO (ABAS E CÁLCULOS) ---
            const faturamentoTabButtons = document.querySelectorAll('.faturamento-tab-button');
            const faturamentoTabContents = document.querySelectorAll('.faturamento-tab-content');
            
            faturamentoTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTabId = `${button.dataset.tab}-tab`;
                    faturamentoTabButtons.forEach(btn => btn.classList.add('text-subtle'));
                    button.classList.remove('text-subtle');
                    faturamentoTabContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== targetTabId);
                    });
                    safeCreateIcons();
                });
            });

            // Aba 1: Calculo do Simples
            const faturamentoForm = document.getElementById('faturamento-form');
            document.getElementById('calcular-faturamento').addEventListener('click', () => {
                const rbt12 = parseLocalFloat(document.getElementById('rbt12').value);
                const rpa = parseLocalFloat(document.getElementById('rpa').value);
                const mesAnterior = parseLocalFloat(document.getElementById('mes_anterior').value);
                const numMeses = parseInt(document.getElementById('num_meses').value) || 0;
                document.getElementById('resultado1').textContent = formatCurrency(rbt12 / 12);
                document.getElementById('resultado2').textContent = formatCurrency(((rbt12 + rpa) - mesAnterior) / 12);
                document.getElementById('resultado3').textContent = formatCurrency(numMeses > 0 ? (rpa + rbt12) / numMeses : 0);
            });
            document.getElementById('limpar-faturamento').addEventListener('click', () => {
                faturamentoForm.reset();
                document.getElementById('resultado1').textContent = formatCurrency(0);
                document.getElementById('resultado2').textContent = formatCurrency(0);
                document.getElementById('resultado3').textContent = formatCurrency(0);
            });

            // Aba 2: Rel. Faturamento
            const relFaturamentoInputsContainer = document.getElementById('rel-faturamento-inputs');
            for (let i = 1; i <= 12; i++) {
                relFaturamentoInputsContainer.innerHTML += `
                    <div class="flex items-center gap-2">
                        <label for="rel-mes-${i}" class="w-20 text-sm font-medium">Mês ${i}</label>
                        <input type="text" inputmode="decimal" id="rel-mes-${i}" placeholder="R$ 0,00" class="rel-faturamento-input w-full p-2 rounded-xl neumorphic-inset focus:outline-none text-sm">
                    </div>
                `;
            }
            const relFaturamentoInputs = document.querySelectorAll('.rel-faturamento-input');
            const calcularRelFaturamento = () => {
                let total = 0;
                relFaturamentoInputs.forEach(input => {
                    total += parseLocalFloat(input.value);
                });
                document.getElementById('rel-faturamento-renda-12-meses').textContent = formatCurrency(total);
                document.getElementById('rel-faturamento-renda-mensal').textContent = formatCurrency(total / 12);
            };
            relFaturamentoInputs.forEach(input => input.addEventListener('input', calcularRelFaturamento));
            document.getElementById('rel-faturamento-limpar').addEventListener('click', () => {
                relFaturamentoInputs.forEach(input => input.value = '');
                calcularRelFaturamento();
            });

            // Aba 3: Semoventes
            const semoventesTbody = document.getElementById('semoventes-tbody');
            const semoventesData = [
                'Matrizes (+ 36 meses)', 'Touros', 'Bois (+ 36 meses)', 'Novilhas (25 a 36 meses)',
                'Novilhos (25 a 36 meses)', 'Novilhas (13 a 24 meses)', 'Novilhos (13 a 24 meses)',
                'Bezerras/terneiras até 12 meses', 'Bezerros/terneiros até 12 meses'
            ];
            semoventesData.forEach((desc, index) => {
                semoventesTbody.innerHTML += `
                    <tr class="border-b border-slate-300 dark:border-slate-700">
                        <td class="p-2">${desc}</td>
                        <td class="p-2"><input type="number" id="semovente-qtd-${index}" class="semovente-input w-20 p-2 rounded-xl neumorphic-inset focus:outline-none text-sm" placeholder="0"></td>
                        <td class="p-2"><input type="text" inputmode="decimal" id="semovente-valor-${index}" class="semovente-input w-32 p-2 rounded-xl neumorphic-inset focus:outline-none text-sm" placeholder="R$ 0,00"></td>
                        <td class="p-2 font-semibold" id="semovente-total-${index}">R$ 0,00</td>
                    </tr>
                `;
            });
            const semoventeInputs = document.querySelectorAll('.semovente-input');
            const calcularSemoventes = () => {
                let grandTotalAnual = 0;
                let grandTotalQtd = 0;
                semoventesData.forEach((_, index) => {
                    const qtd = parseInt(document.getElementById(`semovente-qtd-${index}`).value) || 0;
                    const valor = parseLocalFloat(document.getElementById(`semovente-valor-${index}`).value);
                    const total = qtd * valor;
                    document.getElementById(`semovente-total-${index}`).textContent = formatCurrency(total);
                    grandTotalAnual += total;
                    grandTotalQtd += qtd;
                });
                document.getElementById('semoventes-qtd-total').textContent = grandTotalQtd;
                document.getElementById('semoventes-renda-anual').textContent = formatCurrency(grandTotalAnual);
                document.getElementById('semoventes-renda-mensal').textContent = formatCurrency(grandTotalAnual / 12);
            };
            semoventeInputs.forEach(input => input.addEventListener('input', calcularSemoventes));
            document.getElementById('semoventes-limpar').addEventListener('click', () => {
                semoventeInputs.forEach(input => input.value = '');
                calcularSemoventes();
            });

            // Aba 4: NF's
            const nfsGrid = document.getElementById('nfs-grid');
            for (let i = 1; i <= 152; i++) {
                nfsGrid.innerHTML += `
                    <div class="flex items-center gap-2">
                        <label for="nf-${i}" class="text-sm font-medium w-12"> ${i}</label>
                        <input type="text" inputmode="decimal" id="nf-${i}" class="nf-input w-full p-2 rounded-xl neumorphic-inset focus:outline-none text-sm" placeholder="0,00">
                    </div>
                `;
            }
            const nfInputs = document.querySelectorAll('.nf-input');
            const nfsPropriedadeInput = document.getElementById('nfs-propriedade');
            const calcularNFs = () => {
                let total = 0;
                nfInputs.forEach(input => {
                    total += parseLocalFloat(input.value);
                });
                const propriedade = parseLocalFloat(nfsPropriedadeInput.value) / 100;
                const rendaAnual = total * (propriedade > 0 ? propriedade : 1);
                document.getElementById('nfs-renda-anual').textContent = formatCurrency(rendaAnual);
                document.getElementById('nfs-renda-mensal').textContent = formatCurrency(rendaAnual / 12);
            };
            nfInputs.forEach(input => input.addEventListener('input', calcularNFs));
            nfsPropriedadeInput.addEventListener('input', calcularNFs);
            document.getElementById('nfs-limpar').addEventListener('click', () => {
                nfInputs.forEach(input => input.value = '');
                nfsPropriedadeInput.value = '100';
                calcularNFs();
            });

            // Aba 5: Quotas
            const quotasInputs = document.querySelectorAll('#quotas-tab input');
            const calcularQuotas = () => {
                // Bloco 1: Calcular %
                const valorTotal1 = parseLocalFloat(document.getElementById('quotas-valor-total-empresa-1').value);
                const valorAssociado1 = parseLocalFloat(document.getElementById('quotas-valor-associado-1').value);
                let percentual = 0;
                if (valorTotal1 > 0) {
                    percentual = (valorAssociado1 / valorTotal1) * 100;
                }
                document.getElementById('quotas-percentual-resultado').textContent = percentual.toFixed(2).replace('.', ',') + '%';

                // Bloco 2: Calcular Valor
                const valorTotal2 = parseLocalFloat(document.getElementById('quotas-valor-total-empresa-2').value);
                const percentualAssociado2 = parseLocalFloat(document.getElementById('quotas-percentual-associado-2').value);
                const valorMonetario = valorTotal2 * (percentualAssociado2 / 100);
                document.getElementById('quotas-valor-resultado').textContent = formatCurrency(valorMonetario);
            };
            quotasInputs.forEach(input => input.addEventListener('input', calcularQuotas));
            document.getElementById('quotas-limpar').addEventListener('click', () => {
                quotasInputs.forEach(input => input.value = '');
                calcularQuotas();
            });

            // Aba 6: FCPR
            const fcprInputsContainer = document.getElementById('fcpr-inputs');
            for (let i = 1; i <= 10; i++) {
                fcprInputsContainer.innerHTML += `
                    <div class="flex items-center gap-2">
                        <label for="fcpr-renda-${i}" class="w-24 text-sm font-medium">Renda ${i}</label>
                        <input type="text" inputmode="decimal" id="fcpr-renda-${i}" placeholder="R$ 0,00" class="fcpr-input w-full p-2 rounded-xl neumorphic-inset focus:outline-none text-sm">
                    </div>
                `;
            }
            const fcprInputs = document.querySelectorAll('.fcpr-input');
            const fcprPercentualInput = document.getElementById('fcpr-percentual');
            const fcprMesesInput = document.getElementById('fcpr-meses');
            const calcularFCPR = () => {
                let totalRendas = 0;
                fcprInputs.forEach(input => {
                    totalRendas += parseLocalFloat(input.value);
                });
                const percentual = parseLocalFloat(fcprPercentualInput.value) / 100;
                const meses = parseInt(fcprMesesInput.value) || 12;
                const rendaAnual = totalRendas * (percentual > 0 ? percentual : 1);
                document.getElementById('fcpr-renda-anual').textContent = formatCurrency(rendaAnual);
                document.getElementById('fcpr-renda-mensal').textContent = formatCurrency(meses > 0 ? rendaAnual / meses : 0);
            };
            fcprInputs.forEach(input => input.addEventListener('input', calcularFCPR));
            fcprPercentualInput.addEventListener('input', calcularFCPR);
            fcprMesesInput.addEventListener('input', calcularFCPR);
            document.getElementById('fcpr-limpar').addEventListener('click', () => {
                fcprInputs.forEach(input => input.value = '');
                fcprPercentualInput.value = '100';
                fcprMesesInput.value = '12';
                calcularFCPR();
            });


            // --- LÓGICA DO MÓDULO RENDA PF (ABAS E CÁLCULOS) ---
            const rendaPfTabButtons = document.querySelectorAll('.renda-pf-tab-button');
            const rendaPfTabContents = document.querySelectorAll('.renda-pf-tab-content');
            rendaPfTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTabId = `${button.dataset.tab}-tab`;
                    rendaPfTabButtons.forEach(btn => btn.classList.add('text-subtle'));
                    button.classList.remove('text-subtle');
                    rendaPfTabContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== targetTabId);
                    });
                });
            });

            // Aba 1: Calculadora SISBR
            const valorSisbrInput = document.getElementById('valor_sisbr');
            valorSisbrInput.addEventListener('input', () => {
                const valor = parseLocalFloat(valorSisbrInput.value);
                document.getElementById('sisbr_mult').textContent = formatCurrency(valor * 12);
                document.getElementById('sisbr_div').textContent = formatCurrency(valor / 12);
            });
            document.getElementById('limpar_sisbr').addEventListener('click', () => {
                valorSisbrInput.value = '';
                valorSisbrInput.dispatchEvent(new Event('input'));
            });

            // Aba 2: Média Holerites
            const mediaInputs = document.querySelectorAll('.media-holerite-input');
            const limparMediaBtn = document.getElementById('limpar_media');
            function calcularMedia() {
                let total = 0;
                let count = 0;
                mediaInputs.forEach(inp => {
                    const val = parseLocalFloat(inp.value);
                    if (!isNaN(val) && val > 0) {
                        total += val;
                        count++;
                    }
                });
                const media = count > 0 ? total / count : 0;
                document.getElementById('media_resultado').textContent = formatCurrency(media);
            }
            mediaInputs.forEach(input => input.addEventListener('input', calcularMedia));
            limparMediaBtn.addEventListener('click', () => {
                mediaInputs.forEach(input => input.value = '');
                calcularMedia();
            });

            // Aba 3: Soma de Valores
            const somaInputs = document.querySelectorAll('.soma-valor-input');
            const subInputs = document.querySelectorAll('.sub-valor-input');
            const limparSomaBtn = document.getElementById('limpar_soma');
            function calcularSomaTotal() {
                let totalSoma = 0;
                somaInputs.forEach(inp => totalSoma += parseLocalFloat(inp.value));
                let totalSub = 0;
                subInputs.forEach(inp => totalSub += parseLocalFloat(inp.value));
                const somaFinal = totalSoma - totalSub;
                document.getElementById('soma_total_resultado').textContent = formatCurrency(somaFinal);
                document.getElementById('soma_div12_resultado').textContent = formatCurrency(somaFinal / 12);
            }
            somaInputs.forEach(input => input.addEventListener('input', calcularSomaTotal));
            subInputs.forEach(input => input.addEventListener('input', calcularSomaTotal));
            limparSomaBtn.addEventListener('click', () => {
                somaInputs.forEach(input => input.value = '');
                subInputs.forEach(input => input.value = '');
                calcularSomaTotal();
            });

            // --- LÓGICA DO MÓDULO DE REGRAS (ABAS E FILTRO) ---
            const regrasTbody = document.getElementById('regras-irpf-tbody');
            
            function renderRegrasTable() {
                const regrasData = [
                    { item: '01', ref: 'Bolsa de estudo e de pesquisa', type: ['Outros', 'Bolsa de estudo', 'Bolsa do governo'] },
                    { item: '02', ref: 'Ganho de capital na alienação de bens', type: ['Outros'] },
                    { item: '03', ref: 'Capital das apólices de seguro', type: ['Outros'] },
                    { item: '04', ref: 'Indenizações por rescisão', type: ['Outros'] },
                    { item: '06', ref: 'Ganho de capital na alienação do único imóvel', type: ['Outros'] },
                    { item: '06', ref: 'Rendimentos de aplicações financeiras', type: ['Outros', 'Aplicação'] },
                    { item: '07', ref: 'Ganho de capital na venda de imóveis residenciais', type: ['Outros'] },
                    { item: '08', ref: 'Ganho de capital na alienação de moeda estrangeira', type: ['Outros'] },
                    { item: '09', ref: 'Lucros e dividendos recebidos', type: ['Outros', 'Pró-labore'] },
                    { item: '10', ref: 'Parcela isenta de proventos de aposentadoria', type: ['Aposentadoria'] },
                    { item: '10', ref: 'Juros sobre capital próprio', type: ['Outros'] },
                    { item: '11', ref: 'Participação nos lucros e dividendos', type: ['Outros'] },
                    { item: '11', ref: 'Pensão, proventos de aposentadoria por moléstia grave', type: ['Aposentadoria', 'Pensão alimentícia'] },
                    { item: '12', ref: 'Rendimentos de caderneta de poupança (LCA, LCI)', type: ['Outros', 'Aplicação'] },
                    { item: '13', ref: 'Rendimento de sócio ou titular de microempresa', type: ['Outros'] },
                    { item: '14', ref: 'Transferências patrimoniais - doações e heranças', type: ['Outros'] },
                    { item: '15', ref: 'Parcelas não tributáveis (atividade rural)', type: ['Agropecuária'] },
                    { item: '16', ref: 'Imposto sobre a renda de anos anteriores', type: ['Outros'] },
                    { item: '17', ref: 'Rendimento assalariado em moeda estrangeira', type: ['Salário e outros'] },
                    { item: '18', ref: 'Incorporações de reserva ao capital', type: ['Outros'] },
                    { item: '19', ref: 'Transferências patrimoniais', type: ['Outros'] },
                    { item: '20', ref: 'Ganhos líquidos de operações no mercado à vista', type: ['Outros', 'Aplicação'] },
                    { item: '21', ref: 'Ganhos com operações com ouro', type: ['Outros', 'Prestação de serviço'] },
                    { item: '22', ref: 'Recuperação de prejuízos em renda variável', type: ['Outros'] },
                    { item: '23', ref: 'Rendimento bruto, transporte de carga', type: ['Outros', 'Prestação de serviço'] },
                    { item: '24', ref: 'Rendimento bruto, transporte de passageiros', type: ['Outros', 'Prestação de serviço'] },
                    { item: '25', ref: 'Restituição do imposto de renda', type: ['Outros'] },
                    { item: '28', ref: 'Pensão alimentícia', type: ['Outros', 'Pensão alimentícia'] },
                    { item: '99', ref: 'Outros', type: ['Outros'] },
                ];
                regrasTbody.innerHTML = '';
                regrasData.forEach(regra => {
                    const row = `
                        <tr class="border-b border-slate-300 dark:border-slate-700">
                            <td class="p-2 font-semibold">${regra.item}</td>
                            <td class="p-2">${regra.ref}</td>
                            <td class="p-2">${regra.type.join(', ')}</td>
                        </tr>
                    `;
                    regrasTbody.innerHTML += row;
                });
            }

            // --- LÓGICA DO MÓDULO DE CONSULTA CNPJ ---
            const cnpjInput = document.getElementById('cnpj-input');
            const consultarCnpjBtn = document.getElementById('consultar-cnpj');
            const limparCnpjBtn = document.getElementById('limpar-cnpj');
            const cnpjResultsContainer = document.getElementById('cnpj-results-container');

            cnpjInput.addEventListener('input', (e) => {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
                e.target.value = value.slice(0, 18);
            });

            consultarCnpjBtn.addEventListener('click', async () => {
                const cnpj = cnpjInput.value.replace(/\D/g, '');
                if (cnpj.length !== 14) {
                    cnpjResultsContainer.innerHTML = `<div class="p-4 rounded-2xl neumorphic-inset text-center text-red-500">Por favor, insira um CNPJ válido.</div>`;
                    return;
                }

                cnpjResultsContainer.innerHTML = `<div class="p-4 rounded-2xl neumorphic-inset text-center">Consultando...</div>`;

                try {
                    const response = await fetch(`https://publica.cnpj.ws/cnpj/${cnpj}`);
                    if (!response.ok) {
                         const errorData = await response.json().catch(() => null);
                        let errorMessage = `Erro ${response.status}: Não foi possível consultar o CNPJ. Tente novamente.`;
                        if (response.status === 404) errorMessage = "CNPJ não encontrado.";
                        else if (response.status === 429) errorMessage = "Muitas requisições. Por favor, aguarde um minuto.";
                        else if (errorData && errorData.detalhes) errorMessage = errorData.detalhes;
                        throw new Error(errorMessage);
                    }
                    const data = await response.json();
                    displayCnpjResults(data);
                } catch (error) {
                    cnpjResultsContainer.innerHTML = `<div class="p-4 rounded-2xl neumorphic-inset text-center text-red-500">${error.message}</div>`;
                }
            });

            function displayCnpjResults(data) {
                const isSimples = data.simples?.optante_pelo_simples ? 'Sim' : 'Não';
                const isSimei = data.simples?.optante_pelo_simei ? 'Sim' : 'Não';
                const porteEmpresa = data.porte?.descricao || 'Não informado';
                const lastUpdated = data.atualizado_em ? new Date(data.atualizado_em).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'Não informado';
                
                const nomeEmpresa = data.razao_social || 'Não informado'; 
                const data_abertura = data.data_inicio_atividade ? new Date(data.data_inicio_atividade.split('/').reverse().join('-')).toLocaleDateString('pt-BR') : 'Não informado';

                let sociosHtml = '<p class="text-subtle">Nenhum sócio encontrado.</p>';
                if (data.socios && data.socios.length > 0) {
                    sociosHtml = `<ul class="list-disc list-inside">${data.socios.map(socio => `<li>${socio.nome} <span class="text-subtle">(${socio.qualificacao_socio.descricao || 'Sócio'})</span></li>`).join('')}</ul>`;
                }

                const rawJsonHtml = `
                    <details class="mt-4">
                        <summary class="cursor-pointer font-semibold text-sm text-subtle">Ver resposta JSON completa</summary>
                        <pre class="mt-2 p-4 rounded-2xl neumorphic-inset text-xs overflow-auto custom-scrollbar"><code>${JSON.stringify(data, null, 2)}</code></pre>
                    </details>
                `;

                cnpjResultsContainer.innerHTML = `
                    <div class="space-y-4">
                        <div class="p-4 rounded-2xl neumorphic-inset">
                            <p class="text-sm text-subtle uppercase tracking-wide">Nome da Empresa</p>
                            <p class="text-lg font-bold text-accent mt-1">${nomeEmpresa}</p>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Data de Abertura</p>
                                <p class="font-semibold mt-1">${data_abertura}</p>
                            </div>
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Última Atualização</p>
                                <p class="font-semibold mt-1">${lastUpdated}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Situação Cadastral</p>
                                <p class="text-lg font-bold text-accent mt-1">${data.situacao_cadastral?.descricao || 'Não informado'}</p>
                            </div>
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Porte da Empresa</p>
                                <p class="font-semibold mt-1">${porteEmpresa}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Optante Simples</p>
                                <p class="text-lg font-bold text-accent mt-1">${isSimples}</p>
                            </div>
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Optante SIMEI</p>
                                <p class="text-lg font-bold text-accent mt-1">${isSimei}</p>
                            </div>
                        </div>
                        <div class="p-4 rounded-2xl neumorphic-inset">
                            <p class="text-sm text-subtle uppercase tracking-wide">Atividade Principal (CNAE)</p>
                            <p class="font-semibold mt-1">${data.estabelecimento?.atividade_principal?.descricao || 'Não informado'}</p>
                        </div>
                        <div class="p-4 rounded-2xl neumorphic-inset">
                            <p class="text-sm text-subtle uppercase tracking-wide mb-2">Sócios</p>
                            <div class="font-semibold">${sociosHtml}</div>
                        </div>
                        ${rawJsonHtml}
                    </div>
                `;
            };

            limparCnpjBtn.addEventListener('click', () => {
                cnpjInput.value = '';
                cnpjResultsContainer.innerHTML = '';
            });

            // --- LÓGICA DO MÓDULO DE PARECERES ---
            const pareceresDataCorrigido = {
                "Pareceres Gerais": {
                    "DOCUMENTO ILEGÍVEL": "FAVOR ANEXAR DOCUMENTO LEGÍVEL, POIS NÃO FOI POSSÍVEL IDENTIFICAR COM NITIDEZ AS INFORMAÇÕES NO DOCUMENTO ANEXADO.",
                    "DOCUMENTO INVÁLIDO": "O DOCUMENTO ANEXADO NÃO É VÁLIDO PARA COMPROVAR O TIPO DE FLUXO VIGENTE. FAVOR ANEXAR A DOCUMENTAÇÃO VÁLIDA.",
                    "PRAZO DE VALIDADE": "O DOCUMENTO ANEXADO ESTÁ FORA DO PRAZO DE VALIDADE (90 DIAS). FAVOR ANEXAR UM DOCUMENTO ATUALIZADO QUE COMPROVE A INCLUSÃO/ALTERAÇÃO.",
                    "CHAVES INCORRETAS": "O DOCUMENTO FOI ANEXADO NA CHAVE INCORRETA. FAVOR CORRIGIR.",
                    "ASSINATURAS INVÁLIDAS": "O DOCUMENTO ANEXADO CONTÉM ASSINATURAS INVÁLIDAS OU HÍBRIDAS. FAVOR ANEXAR DOCUMENTO COM ASSINATURAS VÁLIDAS.",
                    "VÍNCULO NÃO ENCONTRADO": "NÃO FOI POSSÍVEL LOCALIZAR O VÍNCULO DO ASSOCIADO COM O TERCEIRO MENCIONADO NO DOCUMENTO. FAVOR ANEXAR DOCUMENTO QUE COMPROVE O VÍNCULO.",
                    "FALTA DE DOCUMENTO COMPROBATÓRIO": "FAVOR ANEXAR A DOCUMENTAÇÃO QUE COMPROVE A INCLUSÃO/ALTERAÇÃO.",
                    "DESCRIÇÃO DIVERGENTE": "A DESCRIÇÃO INFORMADA NO FLUXO NÃO CONDIZ COM OS COMPROVANTES ANEXADOS.",
                    "DOCUMENTO CORTADO OU RASURADO": "O DOCUMENTO ANEXADO ESTÁ CORTADO OU RASURADO. FAVOR ANEXAR A DOCUMENTAÇÃO COMPLETA E LEGÍVEL.",
                    "EXCLUSÃO NÃO PERMITIDA": "A EXCLUSÃO DO FLUXO NÃO FOI PERMITIDA PELO SISTEMA, QUE EXIBIU UMA MENSAGEM DE ERRO DURANTE A TENTATIVA.",
                    "CADASTRO DIVERGENTE DO COMPROVANTE": "AS INFORMAÇÕES CADASTRADAS DIVERGEM DO COMPROVANTE ANEXADO OU NÃO FORAM DEVIDAMENTE ATUALIZADAS.",
                    "CAPTURA DE TELA INVÁLIDA": "O DOCUMENTO ANEXADO É UMA CAPTURA DE TELA (PRINT). FAVOR ANEXAR O DOCUMENTO ORIGINAL E VÁLIDO.",
                    "APROVAÇÃO SEM VALIDAÇÃO": "APROVAÇÃO REALIZADA CONFORME DOCUMENTAÇÃO VIGENTE, DEVIDO À FALTA DE DOCUMENTOS NO CAMPO 'NOVO'."
                },
                "Fluxos de Fontes de Renda": {
                    "Pareceres Gerais de Renda": {
                        "RENDA MENSAL INVÁLIDA": "A RENDA CADASTRADA NÃO É VÁLIDA PARA COMPROVAÇÃO. FAVOR UTILIZAR UMA FONTE DE RENDA VÁLida PARA A INCLUSÃO/ALTERAÇÃO.",
                        "TIPO DE RENDA INCORRETO": "CORRIGIR O TIPO DE RENDA PARA {}.",
                        "DIVISÃO DE RENDA MENSAL INCORRETA": "A DIVISÃO DA RENDA MENSAL ESTÁ INCORRETA. FAVOR CORRIGIR PARA {}.",
                        "RENDA PROVENIENTE DE FONTES PAGADORAS DIVERGENTES": "A RENDA UTILIZADA É UMA SOMA DE FONTES DISTINTAS. FAVOR CADASTRÁ-LAS SEPARADAMENTE.",
                        "ASSINATURAS PRO-LABORE": "O DOCUMENTO ANEXADO NECESSITA DA ASSINATURA DO CONTADOR, REPRESENTANTE DA EMPRESA OU EMPREGADO SICOOB. SOLICITAMOS QUE O MESMO SEJA REENVIADO DEVIDAMENTE ASSINADO."
                    },
                    "Pareceres de Renda Agropecuária": {
                        "RENDA NÃO PROVENIENTE DE ATIVIDADE RURAL": "A RENDA CADASTRADA NÃO É AGROPECUÁRIA. FAVOR CORRIGIR O TIPO DE RENDA PARA {}.",
                        "DIVISÃO DE RENDA AGROPECUÁRIA INCORRETA": "A DIVISÃO DA RENDA FAMILIAR ESTÁ INCORRETA. FAVOR CORRIGIR PARA {}.",
                        "LAUDO DE PRODUÇÃO AGROPECUÁRIA": "FAVOR AJUSTAR O LAUDO DE PRODUÇÃO AGROPECUÁRIA. O DOCUMENTO INDICA {} QUANDO O CORRETO SERIA {}.",
                        "RENDA EFETIVA SOMADA COM PREVISÃO": "FOI UTILIZADA RENDA EFETIVA SOMADA COM PREVISÃO PARA A RENDA ANUAL. FAVOR CORRIGIR O VALOR DA RENDA PARA R$ {}."
                    },
                    "Pareceres de Renda - SIMPLES Nacional": {
                        "COMPROVANTE DO SIMPLES NACIONAL": "SÓ SÃO PERMITIDOS DOCUMENTOS DO SIMPLES PARA EMPRESAS OPTANTES DO SIMPLES NACIONAL. FAVOR ANEXAR O COMPROVANTE CORRETO.",
                        "CONSULTA DE OPÇÃO DO SIMPLES": "FAVOR ANEXAR O COMPROVANTE DE OPÇÃO PELO SIMPLES NACIONAL.",
                        "CAMPO 'OPTANTE DO SIMPLES'": "AJUSTAR O CAMPO 'OPTANTE DO SIMPLES NACIONAL' PARA 'SIM' OU 'NÃO'.",
                        "CÁLCULO DO SIMPLES": "A RENDA CADASTRADA ESTÁ INCORRETA. FAVOR CORRIGIR PARA R$ {} (1ª FORMA DE CÁLCULO) OU PARA R$ {} (2ª FORMA DE CÁLCULO)."
                    },
                    "Pareceres de Renda - Pessoa Física": {
                        "PRÓ-LABORE ACIMA DO LIMITE (MEI)": "A RENDA CADASTRADA ULTRAPASSA O LIMITE DE R$ 6.750,00 PARA PRÓ-LABORE DE EMPRESAS MEI.",
                        "RENDA DE TERCEIRO": "A RENDA CADASTRADA ESTÁ EM NOME DE TERCEIROS. FAVOR INFORMAR UMA RENDA PRÓPRIA.",
                        "RENDA INFORMADA NÃO RECORRENTE": "A RENDA UTILIZADA NÃO É RECORRENTE. FAVOR CADASTRÁ-LA SEPARADAMENTE COM O TIPO DE RENDA 'OUTROS'."
                    }
                },
                "Fluxos de Pessoa": {
                    "Pareceres Gerais de Pessoa": {
                        "TIPO DE DOCUMENTO": "CORRIGIR O TIPO DE DOCUMENTO PARA {}.",
                        "NÚMERO DO DOCUMENTO": "O NÚMERO CADASTRADO DIVERGE DO DOCUMENTO ANEXADO. CORRIGIR PARA {}.",
                        "DATA DE EMISSÃO": "CORRIGIR A DATA DE EMISSÃO PARA {}.",
                        "FICHA CADASTRAL": "DADOS INCORRETOS NA FICHA CADASTRAL. FAVOR AJUSTAR.",
                        "FICHA PEP": "PREENCHIMENTO INCORRETO DA FICHA DE PESSOA POLITICAMENTE EXPOSTA (PEP).",
                        "UF DO ÓRGÃO EXPEDIDOR": "CORRIGIR A UF DO ÓRGÃO EXPEDIDOR PARA {}."
                    },
                    "Pareceres de Pessoa Física": {
                        "ESTADO CIVIL": "CORRIGIR O ESTADO CIVIL PARA {}.",
                        "ÓRGÃO EXPEDIDOR": "CORRIGIR O ÓRGÃO EXPEDIDOR PARA {}.",
                        "NATURALIDADE": "CORRIGIR A NATURALIDADE PARA {}."
                    },
                    "Pareceres de Pessoa Jurídica": {
                        "DATA DE CONSTITUIÇÃO": "CORRIGIR A DATA DE CONSTITUIÇÃO PARA {}.",
                        "NÚMERO DE REGISTRO NO ÓRGÃO COMPETENTE": "CORRIGIR O NÚMERO DE REGISTRO NO ÓRGÃO COMPETENTE PARA {}.",
                        "NÚMERO DA ÚLTIMA ALTERAÇÃO DO CONTRATO SOCIAL": "CORRIGIR O NÚMERO DA ÚLTIMA ALTERAÇÃO DO CONTRATO SOCIAL PARA {}.",
                        "DATA DA ÚLTIMA ALTERAÇÃO DO CONTRATO SOCIAL": "CORRIGIR A DATA DA ÚLTIMA ALTERAÇÃO DO CONTRato SOCIAL PARA {}.",
                        "NÚMERO DE REGISTRO DE REPRESENTAÇÃO": "CORRIGIR O NÚMERO DE REGISTRO DE REPRESENTAÇÃO PARA {}.",
                        "DATA DE REGISTRO DE REPRESENTAÇÃO": "CORRIGIR A DATA DE REGISTRO DE REPRESENTAÇÃO PARA {}.",
                        "OPÇÃO MEI": "AJUSTAR A OPÇÃO 'MEI' PARA {}.",
                        "NÚMERO DO CONTRATO SOCIAL": "CORRIGIR O NÚMERO DO CONTRATO SOCIAL PARA {}.",
                        "CAPITAL SOCIAL": "CORRIGIR O CAPITAL SOCIAL PARA R$ {}.",
                        "INSCRIção ESTADUAL": "CORRIGIR A INSCRIÇÃO ESTADUAL PARA {}.",
                        "DATA DE REGISTRO NO ÓRGÃO COMPETENTE": "CORRIGIR A DATA DE REGISTRO NO ÓRGÃO COMPETENTE PARA {}."
                    }
                },
                "Fluxos de Endereço": {
                    "TIPO DE ENDEREÇO": "CORRIGIR O TIPO DE ENDEREÇO PARA {}.",
                    "LOGRADOURO": "CORRIGIR O LOGRADOURO PARA {}.",
                    "NÚMERO": "CORRIGIR O NÚMERO PARA {}."
                },
                "Fluxos de Relacionamento": {
                    "Pareceres Gerais de Relacionamento": {
                        "TIPO DE RELACIONAMENTO INCORRETO": "O TIPO DE RELACIONAMENTO NÃO CONDIZ COM A DOCUMENTAÇÃO FORNECIDA. FAVOR AJUSTAR.",
                        "DATA DE INÍCIO DO MANDATO INVÁLIDA": "A DATA DE INÍCIO DO MANDATO ESTÁ INVÁLIDA OU NÃO CONDIZ COM O DOCUMENTO. FAVOR CORRIGIR PARA {}.",
                        "DATA DE FIM DO MANDATO INVÁLIDA": "A DATA DE FIM DO MANDATO ESTÁ INCORRETA OU NÃO É COMPATÍVEL COM O DOCUMENTO. FAVOR CORRIGIR PARA {}.",
                        "FALTA NÚMERO DO REGISTRO": "FAVOR INFORMAR O NÚMERO DO REGISTRO.",
                        "FALTA NÚMERO DO LIVRO": "FAVOR INFORMAR O NÚMERO DO LIVRO.",
                        "FALTA NÚMERO DA FOLHA": "FAVOR INFORMAR O NÚMERO DA FOLHA.",
                        "FALTA NOME DO CARTÓRIO": "FAVOR INFORMAR O NOME DO CARTÓRIO."
                    },
                    "Pareceres de Relacionamento - Pessoa Jurídica": {
                        "PERCENTUAL NO CAPITAL SOCIAL INCORRETO": "O PERCENTUAL INFORMADO NO CAPITAL SOCIAL ESTÁ INCORRETO OU INCONSISTENTE. FAVOR CORRIGIR PARA {}%."
                    }
                },
                "Fluxos de Bem": {
                    "Pareceres Gerais de Bem": {
                        "TIPO DO BEM INCORRETO": "O TIPO DO BEM NÃO FOI INFORMADO OU ESTÁ INCORRETO. FAVOR CORRIGIR PARA {}.",
                        "VALOR DE AVALIAÇÃO INCORRETO": "O VALOR DE AVALIAÇÃO ESTÁ INCORRETO OU NÃO CONDIZ COM O LAUDO. FAVOR CORRIGIR PARA R$ {}.",
                        "ÁREA DIVERGENTE": "A ÁREA INFORMADA DIVERGE DA DOCUMENTAÇÃO. FAVOR CORRIGIR PARA {}.",
                        "DATA DE AVALIAÇÃO DIVERGENTE": "A DATA DA AVALIAÇÃO NÃO CORRESPONDE À DATA DO LAUDO. FAVOR CORRIGIR PARA {}.",
                        "VALOR DO BEM INCORRETO": "O VALOR DO BEM INFORMADO NÃO ESTÁ CORRETO. FAVOR CORRIGIR PARA R$ {}.",
                        "DESCRIÇÃO DO BEM INCOMPLETA/INCORRETA": "A DESCRIÇÃO DO BEM NÃO CONDIZ COM O TIPO DE BEM OU ESTÁ INCOMPLETA. FAVOR AJUSTAR.",
                        "CADASTRO INDEVIDO DE BEM EM AQUISIÇÃO": "NÃO É PERMITIDO CADASTRAR BEM EM PROCESSO DE AQUISIÇÃO COMO SE FOSSE DE POSSE PLENA.",
                        "BEM NÃO COMPROVADO COMO PATRIMÔNIO": "O BEM INFORMADO NÃO FOI COMPROVADO COMO PATRIMÔNIO. FAVOR ANEXAR DOCUMENTAÇÃO COMPROBATÓRIA.",
                        "LAUDO DE AVALIAÇÃO INVÁLIDO": "O LAUDO DE AVALIAÇÃO NÃO É VÁLIDO OU NÃO CORRESPONDE AO BEM INFORMADO. FAVOR ANEXAR LAUDO VÁLIDO.",
                        "PERCENTUAL DE PROPRIEDADE INCORRETO": "O PERCENTUAL DE PROPRIEDADE DO BEM NÃO FOI INFORMADO OU ESTÁ INCORRETO. FAVOR CORRIGIR PARA {}%.",
                        "CADASTRO INDEVIDO DE BENS EM CONJUNTO": "OS BENS FORAM INFORMADOS EM CONJUNTO QUANDO DEVERIAM SER CADASTRADOS SEPARADAMENTE. FAVOR REALIZAR CADASTROS INDIVIDUAIS.",
                        "PERCENTUAL INCORRETO NA EXCLUSÃO DE BEM": "POR SE TRATAR DE EXCLUSÃO, O PERCENTUAL DE PROPRIEDADE DEVE SER ZERADO. FAVOR AJUSTAR.",
                        "TIPO DE BEM INVÁLIDO (EMPREENDIMENTO)": "EMPREENDIMENTOS NÃO SÃO ACEITOS COMO BENS PATRIMONIAIS. FAVOR REMOVER O CADASTRO."
                    },
                    "Pareceres de Bens Móveis": {
                        "TIPO DO CHASSI INCORRETO": "O TIPO DE CHASSI ESTÁ INCORRETO. FAVOR CORRIGIR PARA {}.",
                        "NÚMERO DO CHASSI INVÁLIDO": "O NÚMERO DO CHASSI ESTÁ INVÁLIDO OU NÃO FOI REGISTRADO CORRETAMENTE. FAVOR CORRIGIR PARA {}.",
                        "RENAVAM INCORRETO": "O NÚMERO DO RENAVAM ESTÁ INCORRETO OU NÃO CORRESPONDE AO VEÍCULO. FAVOR CORRIGIR PARA {}.",
                        "PLACA INVÁLIDA": "A PLACA DO VEÍCULO ESTÁ INVÁLIDA OU NÃO FOI REGISTRADA CORRETAMENTE. FAVOR CORRIGIR PARA {}.",
                        "ANO DE FABRICAÇÃO INCORRETO": "O ANO DE FABRICAÇÃO INFORMADO ESTÁ INCORRETO. FAVOR CORRIGIR PARA {}.",
                        "ANO MODELO INCORRETO": "O ANO MODELO NÃO CORRESPONDE AO VEÍCULO REGISTRADO. FAVOR CORRIGIR PARA {}."
                    },
                    "Pareceres de Bens Imóveis": {
                        "ÁREA DO IMÓVEL DIVERGENTE": "A ÁREA DO IMÓVEL INFORMADA DIVERGE DA DOCUMENTAÇÃO. FAVOR CORRIGIR PARA {}.",
                        "UNIDADE DE MEDIDA INCOERENTE": "A UNIDADE DE MEDIDA NÃO ESTÁ COERENTE COM O DOCUMENTO. FAVOR CORRIGIR PARA {}."
                    },
                    "Pareceres de Bens Agropecuários": {
                        "QUANTIDADE DE SEMOVENTES DIVERGENTE": "A QUANTIDADE DE SEMOVENTES INFORMADA DIVERGE DO COMPROVANTE. FAVOR CORRIGIR PARA {}.",
                        "PERCENTUAL DE ARRENDAMENTO INCORRETO": "O PERCENTUAL DE ARRENDAMENTO NÃO FOI INFORMADO OU ESTÁ INCORRETO. FAVOR CORRIGIR PARA {}%.",
                        "DESCRIÇÃO DE SEMOVENTES DIVERGENTE": "A DESCRIÇÃO DO SEMOVENTE DIVERGE DO DOCUMENTO. FAVOR AJUSTAR."
                    }
                }
            };


            const searchInput = document.getElementById('searchInput');
            const parecerCategoryFilter = document.getElementById('parecer-category-filter');
            const pareceresContainer = document.getElementById('pareceresContainer');

            function populateParecerFilter() {
                parecerCategoryFilter.innerHTML = '<option value="all">Todas as Categorias</option>';
                for (const mainCategory in pareceresDataCorrigido) {
                    parecerCategoryFilter.innerHTML += `<option value="${mainCategory}">${mainCategory}</option>`;
                }
            }

            function renderPareceres(data) {
                pareceresContainer.innerHTML = '';
                let mainContentRendered = false;

                for (const mainCategory in data) {
                    const subCategories = data[mainCategory];
                    let mainCategoryHtml = `<h3 class="text-2xl font-bold mb-4 border-b-2 border-slate-300 dark:border-slate-600 pb-2">${mainCategory}</h3>`;
                    let contentHtml = '<div class="space-y-4">';
                    let hasSubResults = false;

                    function createParecerHTML(key, value, button) {
                        hasSubResults = true;
                        mainContentRendered = true;
                        const fullParecerText = `${key}: ${value}`;
                        return `
                            <div class="p-4 rounded-2xl neumorphic-inset flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                                <div class="flex-1 min-w-0">
                                    <h5 class="font-semibold mb-1">${key}</h5>
                                    <p class="text-sm whitespace-normal break-words text-subtle">${value}</p>
                                </div>
                                <div class="flex-shrink-0 flex items-center self-start sm:self-center">
                                    <button class="p-2 rounded-2xl neumorphic-outset-sm text-sm font-bold transition duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center gap-2"
                                            onclick="copyParecer(decodeURIComponent('${encodeURIComponent(fullParecerText)}'), this)">
                                        <i data-lucide="copy" class="w-4 h-4"></i> Copiar
                                    </button>
                                </div>
                            </div>
                        `;
                    }

                    for (const subCategoryTitle in subCategories) {
                        const items = subCategories[subCategoryTitle];
                        if (typeof items === 'object' && items !== null) {
                            let subCategoryContent = '';
                            for (const key in items) {
                                subCategoryContent += createParecerHTML(key, items[key]);
                            }
                            if(subCategoryContent) {
                                contentHtml += `<h4 class="text-xl font-semibold mb-3 mt-4">${subCategoryTitle}</h4>` + subCategoryContent;
                            }
                        } else {
                            contentHtml += createParecerHTML(subCategoryTitle, items);
                        }
                    }
                    contentHtml += '</div>';
                    if (hasSubResults) {
                        pareceresContainer.innerHTML += mainCategoryHtml + contentHtml;
                    }
                }

                if (!mainContentRendered) {
                    pareceresContainer.innerHTML = `
                        <div class="text-center text-lg py-8 text-subtle">
                            Nenhum parecer encontrado para a sua pesquisa.
                        </div>
                    `;
                }
                 safeCreateIcons();
            }
            
            function filterPareceres() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCategory = parecerCategoryFilter.value;
                
                const sourceData = selectedCategory === 'all' 
                    ? pareceresDataCorrigido 
                    : { [selectedCategory]: pareceresDataCorrigido[selectedCategory] };

                const filteredData = {};
                for (const mainCategory in sourceData) {
                    const subCategories = sourceData[mainCategory];
                    const filteredSubCategories = {};
                    let hasMatch = false;
                    for (const subCategoryTitle in subCategories) {
                        const items = subCategories[subCategoryTitle];
                        if (typeof items === 'object' && items !== null) {
                            const filteredItems = {};
                            for(const key in items) {
                                if (key.toLowerCase().includes(searchTerm) || items[key].toLowerCase().includes(searchTerm)) {
                                    filteredItems[key] = items[key];
                                    hasMatch = true;
                                }
                            }
                            if(Object.keys(filteredItems).length > 0) {
                                filteredSubCategories[subCategoryTitle] = filteredItems;
                            }
                        } else {
                            if (subCategoryTitle.toLowerCase().includes(searchTerm) || items.toLowerCase().includes(searchTerm)) {
                                filteredSubCategories[subCategoryTitle] = items;
                                hasMatch = true;
                            }
                        }
                    }
                    if (hasMatch) {
                        filteredData[mainCategory] = filteredSubCategories;
                    }
                }
                renderPareceres(filteredData);
            }

            searchInput.addEventListener('input', filterPareceres);
            parecerCategoryFilter.addEventListener('change', filterPareceres);

            // --- LÓGICA DO MÓDULO CONTADOR ---
            const countersGrid = document.getElementById('counters-grid');
            const addCounterBtn = document.getElementById('add-counter-btn');
            const counterTemplate = document.getElementById('counter-template');
            const incrementInput = document.getElementById('increment-by-input');
            const startInput = document.getElementById('counter-start-input');
            const timerToggle = document.getElementById('timer-toggle');
            const resetAllBtn = document.getElementById('contador-reset');

            let counters = [];

            function updateCountersLayout() {
                const count = counters.length;
                const cards = countersGrid.querySelectorAll('.counter-card');
                cards.forEach(card => {
                    card.classList.remove('sm:col-span-2', 'sm:row-span-2');
                });
                
                if (count === 1) {
                    cards[0].classList.add('sm:col-span-2', 'sm:row-span-2');
                } else if (count === 2) {
                    cards.forEach(card => card.classList.add('sm:row-span-2'));
                } else if (count === 3) {
                    cards[2].classList.add('sm:col-span-2');
                }
            }

            function createCounterInstance(id, initialValue, isTimer) {
                const counterElement = counterTemplate.content.cloneNode(true).firstElementChild;
                counterElement.dataset.id = id;
                
                const titleElement = counterElement.querySelector('.counter-title');
                const display = counterElement.querySelector('.counter-display');
                const plusBtn = counterElement.querySelector('.counter-plus');
                const minusBtn = counterElement.querySelector('.counter-minus');
                const removeBtn = counterElement.querySelector('.remove-counter-btn');
                const playBtn = counterElement.querySelector('.timer-play');
                const resetBtn = counterElement.querySelector('.timer-reset');

                if (isTimer) {
                    titleElement.textContent = `Timer ${counters.length + 1}`;
                } else {
                    titleElement.textContent = `Contador ${counters.length + 1}`;
                }

                let value = initialValue;
                let timerInterval = null;
                let initialTimerValue = initialValue;

                const instance = {
                    id, element: counterElement,
                    updateDisplay() {
                        if (isTimer) {
                            const minutes = Math.floor(value / 60).toString().padStart(2, '0');
                            const seconds = (value % 60).toString().padStart(2, '0');
                            display.textContent = `${minutes}:${seconds}`;
                        } else {
                            display.textContent = value;
                        }
                    },
                    remove() {
                        clearInterval(timerInterval);
                        counterElement.classList.add('animate-fade-out');
                        counterElement.addEventListener('animationend', () => {
                            counterElement.remove();
                            counters = counters.filter(c => c.id !== id);
                            updateCountersLayout();
                        }, { once: true });
                    }
                };
                
                removeBtn.addEventListener('click', instance.remove);

                if (isTimer) {
                    display.setAttribute('contenteditable', true);
                    plusBtn.classList.add('hidden');
                    minusBtn.classList.add('hidden');
                    playBtn.classList.remove('hidden');
                    resetBtn.classList.remove('hidden');

                    display.addEventListener('blur', () => {
                        const parts = display.textContent.split(':').map(part => parseInt(part) || 0);
                        value = (parts.length === 2) ? (parts[0] * 60) + parts[1] : parts[0];
                        initialTimerValue = value;
                        instance.updateDisplay();
                    });

                    playBtn.addEventListener('click', () => {
                        if (timerInterval) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                            playBtn.innerHTML = '<i data-lucide="play"></i>';
                        } else if (value > 0) {
                            playBtn.innerHTML = '<i data-lucide="pause"></i>';
                            timerInterval = setInterval(() => {
                                value--;
                                instance.updateDisplay();
                                if (value <= 0) {
                                    clearInterval(timerInterval);
                                    timerInterval = null;
                                    playBtn.innerHTML = '<i data-lucide="play"></i>';
                                }
                            }, 1000);
                        }
                        safeCreateIcons();
                    });

                    resetBtn.addEventListener('click', () => {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        value = initialTimerValue;
                        playBtn.innerHTML = '<i data-lucide="play"></i>';
                        safeCreateIcons();
                        instance.updateDisplay();
                    });

                } else {
                    plusBtn.addEventListener('click', () => {
                        value += parseInt(incrementInput.value) || 1;
                        instance.updateDisplay();
                    });
                    minusBtn.addEventListener('click', () => {
                        value -= parseInt(incrementInput.value) || 1;
                        instance.updateDisplay();
                    });
                }
                
                instance.updateDisplay();
                counters.push(instance);
                countersGrid.appendChild(counterElement);
                safeCreateIcons();
                counterElement.classList.add('animate-fade-in');
            }

            addCounterBtn.addEventListener('click', () => {
                if (counters.length >= 4) return;
                const initialValue = parseInt(startInput.value) || 0;
                const isTimer = timerToggle.checked;
                createCounterInstance(Date.now(), initialValue, isTimer);
                updateCountersLayout();
            });
            
            resetAllBtn.addEventListener('click', () => {
                const startValue = parseInt(startInput.value) || 0;
                counters.forEach(counter => {
                    clearInterval(counter.timerInterval);
                    counter.timerInterval = null;
                    counter.value = startValue;
                    counter.updateDisplay();
                });
            });

            // --- LÓGICA DO MÓDULO CHECKLIST ---
            const checklistData = {
                "flows": {
                    "bem_novo": { "icon": "🏠", "name": "Bem Novo", "documents": {} },
                    "certidao": { "icon": "📄", "name": "Certidão", "documents": {} },
                    "endereco": { 
                        "icon": "📍",
                        "name": "Endereço",
                        "documents": {
                            "conta_energia": { 
                                "name": "Conta de Energia", 
                                "icon": "⚡",
                                "imageUrls": ["./documents/endereco/conta_energia_1.jpg", "./documents/endereco/conta_energia_2.jpg"],
                                "checklist": {
                                    "O documento é valido?": "DOCUMENTO INVÁLIDO",
                                    "O logradouro está correto?": "LOGRADOURO",
                                    "O número do endereço é valido?": "NUMERO",
                                    "A data de emissão está dentro do prazo?": "PRAZO DE VALIDADE",
                                    "O titular do documento tem vinculo com o associado?": "VÍNCULO NÃO ENCONTRADO"
                                }
                            }
                        } },
                    "fonte_de_renda": { 
                        "icon": "💰", 
                        "name": "Fonte de Renda", 
                        "documents": {
                            "declaracao_de_renda": { 
                                "name": "Declaração de Renda", 
                                "icon": "📝", 
                                "imageUrl": "./documents/renda/declaracao_renda.jpg",
                                "checklist": {
                                    "O tipo de renda está correto?": "TIPO DE RENDA INCORRETO",
                                    "O valor da renda está correto?": "RENDA MENSAL INVÁLIDA",
                                    "O documento é válido?": "DOCUMENTO INVÁLIDO",
                                    "A data de emissão está dentro do prazo?": "PRAZO DE VALIDADE",
                                    "As assinaturas estão corretas?": "ASSINATURAS INVÁLIDAS"
                                }
                            },
                            "pgdas_d" : {
                                "name": "PGDAS-D",
                                "icon": "📄",
                                "imageUrls": ["./documents/renda/pgdas_d.jpg", "./documents/renda/recibo_pgdas_d.jpg", "./documents/renda/comprovante_opcao_simples.jpg"],
                                "checklist": {
                                    "O tipo de renda está correto?": "TIPO DE RENDA INCORRETO",
                                    "O documento esta correto?": "DOCUMENTO INVÁLIDO",
                                    "A data de emissão está dentro do prazo?": "PRAZO DE VALIDADE",
                                    "O calculo está correto no sisbr?":"CÁLCULO DO SIMPLES",
                                    "Foi anexado o comprovante do simples":"CONSULTA DE OPÇÃO DO SIMPLES",
                                    "A opção do simples está correta?":"CAMPO 'OPTANTE DO SIMPLES'"
                                }
                            },
                            "extrato_simples": {
                                "name": "Extrato do simples",
                                "icon": "📄",
                                "imageUrls": ["./documents/renda/extrato_simples_1.jpg", "./documents/renda/extrato_simples_2.jpg", "./documents/renda/extrato_simples_3.jpg", "./documents/renda/comprovante_opcao_simples.jpg"],
                                "checklist": {
                                    "O tipo de renda está correto?": "TIPO DE RENDA INCORRETO",
                                    "O documento esta correto?": "DOCUMENTO INVÁLIDO",
                                    "A data de emissão está dentro do prazo?": "PRAZO DE VALIDADE",
                                    "O calculo está correto no sisbr?":"CÁLCULO DO SIMPLES",
                                    "Foi anexado o comprovante do simples":"CONSULTA DE OPÇÃO DO SIMPLES",
                                    "A opção do simples está correta?":"CAMPO 'OPTANTE DO SIMPLES'"
                                }   
                            },
                            "relatorio_inss":{
                                "name": "Relatório INSS",
                                "icon": "👴",
                                "imageUrl": ["./documents/renda/relatorio_inss.jpg"],
                                "checklist": {
                                    "O tipo de renda está correto?": "TIPO DE RENDA INCORRETO",
                                    "O valor da renda está correto?": "RENDA MENSAL INVÁLIDA",
                                    "O documento esta correto?": "DOCUMENTO INVÁLIDO",
                                    "A data de emissão está dentro do prazo?": "PRAZO DE VALIDADE",
                                }
                            }, 
                            "holerite":{
                                "name": "Holerite",
                                "icon": "📃",
                                "imageUrls": ["./documents/renda/holerite_1.jpg", "./documents/renda/holerite_2.jpg"],
                                "checklist": {
                                    "O tipo de renda está correto?": "TIPO DE RENDA INCORRETO",
                                    "O valor da renda está correto?": "RENDA MENSAL INVÁLIDA",
                                    "O documento esta correto?": "DOCUMENTO INVÁLIDO",
                                    "A data de emissão está dentro do prazo?": "PRAZO DE VALIDADE",
                                }
                            },
                            "declaracao_inss":{
                                "name": "Declaração INSS",
                                "icon": "👵",
                                "imageUrl": "./documents/renda/declaracao_inss.jpg",
                                "checklist": {
                                    "O tipo de renda está correto?": "TIPO DE RENDA INCORRETO",
                                    "O valor da renda está correto?": "RENDA MENSAL INVÁLIDA",
                                    "O documento esta correto?": "DOCUMENTO INVÁLIDO",
                                    "A data de emissão está dentro do prazo?": "PRAZO DE VALIDADE",
                                }
                            }
                            //Adicione mais documentos conforme necessário 
                        }
                    },
                    "tributacao": { "icon": "🧾", "name": "Tributação", "documents": {} },
                    "pessoa": { 
                        "icon": "🧑",
                        "name": "Pessoa",
                        "documents": {
                            "cnh_digital":{
                                "name": "CNH Digital",
                                "icon": "🚗",
                                "imageUrl": "./documents/pessoa/cnh_digital.jpg",
                                "checklist": {
                                    "O documento é válido?": "DOCUMENTO INVÁLIDO",
                                    "O tipo de documento é correto?": "TIPO DE DOCUMENTO",
                                    "O número do documento é correto?": "NÚMERO DO DOCUMENTO",
                                    "A data de emissão é correta?": "DATA DE EMISSÃO",
                                    "O orgão expedidor é correto?": "ÓRGÃO EXPEDIDOR",
                                    "A uf de emissão é correta?": "UF DO ÓRGÃO EXPEDIDOR",
                                    "O estado civil é correto?": "ESTADO CIVIL",
                                    "A naturalidade é correta?": "NATURALIDADE",
                                }
                            }
                        } 
                    },
                    "produtividade": { "icon": "📊", "name": "Produtividade", "documents": {} },
                    "produtor": { "icon": "🌾", "name": "Produtor", "documents": {} },
                    "relacionamento": { "icon": "🤝", "name": "Relacionamento", "documents": {} },
                    "responsavel": { "icon": "👨‍💼", "name": "Responsável", "documents": {} }
                }
            };

            function renderChecklist() {
                const container = document.getElementById('checklist-module');
                if (!container) return;
                
                container.innerHTML = `
                    <div id="checklist-flows-view"></div>
                    <div id="checklist-documents-view" class="hidden"></div>
                    <div id="checklist-items-view" class="hidden"></div>
                `;
                
                showFlowsView();
                
                container.addEventListener('click', handleChecklistNavigation);
            }

            function handleChecklistNavigation(e) {
                const flowBtn = e.target.closest('.checklist-flow-btn');
                const docBtn = e.target.closest('.checklist-doc-btn');
                const backBtn = e.target.closest('.checklist-back-btn');
                const finishBtn = e.target.closest('.checklist-finish-btn');
                const copyResultBtn = e.target.closest('.checklist-copy-result-btn');
                const pageNextBtn = e.target.closest('.checklist-page-next');
                const pagePrevBtn = e.target.closest('.checklist-page-prev');
                const backToItemsBtn = e.target.closest('.checklist-back-to-items');

                if (flowBtn) {
                    showDocumentsView(flowBtn.dataset.flow);
                } else if (docBtn) {
                    showChecklistItemsView(docBtn.dataset.flow, docBtn.dataset.doc);
                } else if (backBtn) {
                    const targetView = backBtn.dataset.target;
                    const flowKey = backBtn.dataset.flow;
                    if (targetView === 'flows') {
                        showFlowsView();
                    } else if (targetView === 'documents') {
                        showDocumentsView(flowKey);
                    }
                } else if (finishBtn) {
                    const { flow, doc, page } = finishBtn.dataset;
                    const itemsView = finishBtn.closest('#checklist-items-view');
                    const checkboxes = itemsView.querySelectorAll('.checklist-item-checkbox');
                    const itemsContainer = document.getElementById('checklist-items-container');
                    
                    const devolucoes = [];
                    checkboxes.forEach(cb => {
                        if (!cb.checked) {
                            devolucoes.push(cb.dataset.parecer);
                        }
                    });

                    let resultHTML = '<div class="flex flex-col h-full">';
                    let parecerTextForCopy = "APROVAR";
                    if (devolucoes.length === 0) {
                        resultHTML += `<div class="flex-grow flex flex-col items-center justify-center text-center gap-4"><i data-lucide="party-popper" class="w-16 h-16 text-green-500"></i><p class="text-2xl text-green-500 font-bold">APROVAR</p></div>`;
                    } else {
                        parecerTextForCopy = devolucoes.join('; ');
                        resultHTML += `<div class="flex-grow"><p class="text-red-500 font-medium">${parecerTextForCopy}</p></div>`;
                    }

                    resultHTML += `
                        <div class="mt-auto pt-6 flex flex-col gap-4">
                             <button class="checklist-copy-result-btn w-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2" data-text-to-copy="${encodeURIComponent(parecerTextForCopy)}">
                                <i data-lucide="copy" class="w-5 h-5"></i> Copiar Parecer
                            </button>
                            <button class="checklist-back-to-items w-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2 text-accent" data-flow="${flow}" data-doc="${doc}" data-page="${page}">
                                <i data-lucide="arrow-left-circle" class="w-5 h-5"></i> Voltar
                            </button>
                        </div>
                    </div>
                    `;
                    
                    itemsContainer.innerHTML = resultHTML;
                    safeCreateIcons();

                } else if (copyResultBtn) {
                    const textToCopy = decodeURIComponent(copyResultBtn.dataset.textToCopy);
                    copyParecer(textToCopy, copyResultBtn);
                } else if (pageNextBtn) {
                    const { flow, doc, page } = pageNextBtn.dataset;
                    renderChecklistPage(flow, doc, parseInt(page) + 1);
                } else if (pagePrevBtn) {
                    const { flow, doc, page } = pagePrevBtn.dataset;
                    renderChecklistPage(flow, doc, parseInt(page) - 1);
                } else if (backToItemsBtn) {
                    const { flow, doc, page } = backToItemsBtn.dataset;
                    renderChecklistPage(flow, doc, parseInt(page));
                }
            }
            
            function showFlowsView() {
                const container = document.getElementById('checklist-module');
                container.querySelector('#checklist-flows-view').classList.remove('hidden');
                container.querySelector('#checklist-documents-view').classList.add('hidden');
                container.querySelector('#checklist-items-view').classList.add('hidden');

                const flowsView = container.querySelector('#checklist-flows-view');
                let html = '<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">';
                for (const flowKey in checklistData.flows) {
                    const flow = checklistData.flows[flowKey];
                    html += `
                        <button class="checklist-flow-btn flex flex-col items-center justify-center text-center gap-2 p-3 rounded-2xl neumorphic-outset-sm aspect-square transition-all duration-200 active:scale-95 hover:neumorphic-inset" data-flow="${flowKey}">
                            <span class="text-4xl">${flow.icon}</span>
                            <span class="font-semibold">${flow.name}</span>
                        </button>
                    `;
                }
                html += '</div>';
                flowsView.innerHTML = html;
                safeCreateIcons();
            }

            function showDocumentsView(flowKey) {
                const container = document.getElementById('checklist-module');
                container.querySelector('#checklist-flows-view').classList.add('hidden');
                container.querySelector('#checklist-documents-view').classList.remove('hidden');
                container.querySelector('#checklist-items-view').classList.add('hidden');
                
                const documentsView = container.querySelector('#checklist-documents-view');
                documentsView.className = 'flex flex-col h-full'; 
                
                const flow = checklistData.flows[flowKey];
                
                let headerHtml = `
                    <div class="flex-shrink-0">
                        <div class="flex items-center justify-between gap-4 mb-4">
                            <div class="flex items-center gap-2">
                                <button class="checklist-back-btn p-3 rounded-full neumorphic-outset-sm transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5" data-target="flows">
                                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                                </button>
                                <h3 class="text-xl font-bold truncate">${flow.name}</h3>
                            </div>
                            <div class="relative flex-grow min-w-0">
                                 <input type="text" id="checklist-doc-search" placeholder="Buscar..." class="w-full p-3 pr-10 rounded-2xl neumorphic-inset focus:outline-none text-sm" data-flow="${flowKey}">
                                 <i data-lucide="search" class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-subtle"></i>
                            </div>
                        </div>
                    </div>
                `;

                let contentHtml = '';
                const docKeys = Object.keys(flow.documents);

                if (docKeys.length > 0) {
                    contentHtml = `
                        <div id="checklist-doc-list-container" class="flex-grow overflow-y-auto custom-scrollbar max-h-[50vh] p-3">
                            <!-- A lista de documentos será renderizada aqui -->
                        </div>
                    `;
                } else {
                     contentHtml = `
                        <div class="flex-grow flex flex-col items-center justify-center h-full min-h-[300px] gap-4 text-center p-4 rounded-2xl neumorphic-inset">
                            <i data-lucide="wrench" class="w-12 h-12 text-subtle"></i>
                            <p class="text-lg font-medium text-subtle">Os checklists para ${flow.name} estão sendo construídos.</p>
                        </div>
                    `;
                }

                documentsView.innerHTML = headerHtml + contentHtml;

                if (docKeys.length > 0) {
                    renderDocumentList(flowKey, '');
                }

                const searchInput = document.getElementById('checklist-doc-search');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        renderDocumentList(flowKey, e.target.value);
                    });
                }

                safeCreateIcons();
            }

            function renderDocumentList(flowKey, searchTerm) {
                const listContainer = document.getElementById('checklist-doc-list-container');
                if (!listContainer) return;

                const flow = checklistData.flows[flowKey];
                const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();

                const filteredDocKeys = Object.keys(flow.documents).filter(docKey => {
                    const doc = flow.documents[docKey];
                    return doc.name.toLowerCase().includes(lowerCaseSearchTerm);
                });

                let listHtml = '<div class="grid grid-cols-2 sm:grid-cols-4 gap-4">';
                if (filteredDocKeys.length > 0) {
                    filteredDocKeys.forEach(docKey => {
                        const doc = flow.documents[docKey];
                        listHtml += `
                            <button class="checklist-doc-btn flex flex-col items-center justify-center text-center gap-2 p-3 rounded-2xl neumorphic-outset-sm aspect-square transition-all duration-200 active:scale-95 hover:neumorphic-inset" data-flow="${flowKey}" data-doc="${docKey}">
                                <span class="text-3xl">${doc.icon}</span>
                                <span class="text-xs font-medium">${doc.name}</span>
                            </button>
                        `;
                    });
                } else {
                    listHtml += `<div class="col-span-full text-center py-8 text-subtle">Nenhum documento encontrado.</div>`;
                }
                listHtml += '</div>';

                listContainer.innerHTML = listHtml;
            }

            function showChecklistItemsView(flowKey, docKey) {
                const container = document.getElementById('checklist-module');
                container.querySelector('#checklist-flows-view').classList.add('hidden');
                container.querySelector('#checklist-documents-view').classList.add('hidden');
                container.querySelector('#checklist-items-view').classList.remove('hidden');

                const itemsView = container.querySelector('#checklist-items-view');
                const doc = checklistData.flows[flowKey].documents[docKey];

                itemsView.innerHTML = `
                    <div class="animate-fade-in">
                        <div class="flex items-center flex-shrink-0 mb-6">
                            <button class="checklist-back-btn p-3 rounded-full neumorphic-outset-sm transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5" data-target="documents" data-flow="${flowKey}">
                                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                            </button>
                            <h3 class="text-xl font-bold ml-4 flex items-center gap-2"><span class="text-2xl">${doc.icon}</span> ${doc.name}</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                             <div class="flex flex-col gap-6 sticky top-4">
                                <div id="image-viewer-container" class="p-2 rounded-2xl neumorphic-outset relative min-h-[400px] flex-grow">
                                    </div>
                                <div id="checklist-pagination-controls" class="flex justify-center">
                                    </div>
                            </div>

                            <div id="checklist-items-container" class="p-6 rounded-2xl neumorphic-inset flex flex-col h-full min-h-[50vh]">
                                </div>
                        </div>
                    </div>
                `;
                
                const imageContainer = itemsView.querySelector('#image-viewer-container');
                const paginationContainer = itemsView.querySelector('#checklist-pagination-controls');
                
                paginationContainer.innerHTML = '';

                if (doc.imageUrl || doc.imageUrls) {
                    setupImageSlider(doc, imageContainer, paginationContainer);
                } else {
                    imageContainer.innerHTML = `<div class="flex items-center justify-center h-full text-subtle">Nenhum documento para exibir.</div>`;
                }

                renderChecklistPage(flowKey, docKey, 0);
            }

            function setupImageSlider(doc, imageContainer, paginationContainer) {
                const images = doc.imageUrls || (doc.imageUrl ? [doc.imageUrl] : []);
                if (images.length === 0) return;

                let currentIndex = 0;

                function updateView() {
                    const currentImage = images[currentIndex];
                    imageContainer.innerHTML = `<img src="${currentImage}" alt="Documento" class="w-full h-full object-contain rounded-xl image-viewer-content" onerror="this.onerror=null;this.src='https://placehold.co/400x550/e0e5ec/5a6474?text=Imagem+não+encontrada';">`;
                    
                    if (images.length > 1) {
                        paginationContainer.innerHTML = `
                            <div class="flex items-center justify-center gap-4">
                                <button ${currentIndex === 0 ? 'disabled' : ''} class="checklist-image-prev p-3 rounded-full neumorphic-outset-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 active:scale-90">
                                    <i data-lucide="arrow-left" class="w-5 h-5 pointer-events-none"></i>
                                </button>
                                <div class="flex gap-2 items-center">
                                    ${images.map((_, i) => `<div class="pagination-dot ${i === currentIndex ? 'active' : ''}"></div>`).join('')}
                                </div>
                                <button ${currentIndex === images.length - 1 ? 'disabled' : ''} class="checklist-image-next p-3 rounded-full neumorphic-outset-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 active:scale-90">
                                    <i data-lucide="arrow-right" class="w-5 h-5 pointer-events-none"></i>
                                </button>
                            </div>
                        `;
                        safeCreateIcons();
                    }
                }

                paginationContainer.addEventListener('click', (e) => {
                    if (e.target.closest('.checklist-image-next')) {
                        if (currentIndex < images.length - 1) {
                            currentIndex++;
                            updateView();
                        }
                    }
                    if (e.target.closest('.checklist-image-prev')) {
                        if (currentIndex > 0) {
                            currentIndex--;
                            updateView();
                        }
                    }
                });

                updateView();
            }

            function renderChecklistPage(flowKey, docKey, pageIndex) {
                const itemsContainer = document.getElementById('checklist-items-container');
                const paginationControlsContainer = document.getElementById('checklist-pagination-controls');
                if (!itemsContainer || !paginationControlsContainer) return;
                
                const isPaginationUsedByImageViewer = paginationControlsContainer.innerHTML.trim() !== '';

                const doc = checklistData.flows[flowKey].documents[docKey];
                const checklistItems = Object.entries(doc.checklist || {});
                const itemsPerPage = 8;
                const totalPages = Math.ceil(checklistItems.length / itemsPerPage);

                const start = pageIndex * itemsPerPage;
                const end = start + itemsPerPage;
                const pageItems = checklistItems.slice(start, end);

                let checklistHtml = '<ul class="space-y-4 flex-grow">';
                pageItems.forEach(([itemKey, parecerKey]) => {
                    const parecerText = findParecerText(parecerKey) || "Parecer não encontrado.";
                    const fullParecer = `${parecerKey}: ${parecerText}`;
                    checklistHtml += `
                        <li class="checklist-list-item p-3 rounded-lg transition-colors duration-200">
                            <label class="flex items-start gap-4 cursor-pointer">
                                <input type="checkbox" class="checklist-item-checkbox hidden" data-parecer="${fullParecer}">
                                <span class="custom-checkbox neumorphic-outset-sm">
                                    <i data-lucide="check" class="check-icon w-4 h-4"></i>
                                </span>
                                <span class="font-medium flex-1">${itemKey}</span>
                            </label>
                        </li>`;
                });
                checklistHtml += '</ul>';

                let paginationHtml = '';
                if (totalPages > 1 && !isPaginationUsedByImageViewer) {
                    paginationHtml = `
                        <div class="flex items-center justify-center gap-4">
                            <button ${pageIndex === 0 ? 'disabled' : ''} class="checklist-page-prev p-3 rounded-full neumorphic-outset-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 active:scale-90" data-flow="${flowKey}" data-doc="${docKey}" data-page="${pageIndex}">
                                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                            </button>
                            <div class="flex gap-2 items-center">
                    `;
                    for(let i = 0; i < totalPages; i++) {
                        paginationHtml += `<div class="pagination-dot ${i === pageIndex ? 'active' : ''}"></div>`;
                    }
                    paginationHtml += `
                            </div>
                            <button ${pageIndex >= totalPages - 1 ? 'disabled' : ''} class="checklist-page-next p-3 rounded-full neumorphic-outset-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 active:scale-90" data-flow="${flowKey}" data-doc="${docKey}" data-page="${pageIndex}">
                                <i data-lucide="arrow-right" class="w-5 h-5"></i>
                            </button>
                        </div>
                    `;
                }

                let finishButtonHtml = '';
                if (pageIndex === totalPages - 1 || totalPages === 0) {
                    finishButtonHtml = `
                        <div class="mt-auto pt-6">
                            <button class="checklist-finish-btn w-full p-4 rounded-2xl neumorphic-inset font-semibold text-accent transition-all duration-200 active:scale-95" data-flow="${flowKey}" data-doc="${docKey}" data-page="${pageIndex}">
                                Finalizar
                            </button>
                        </div>
                    `;
                }

                itemsContainer.innerHTML = checklistHtml + finishButtonHtml;
                if (paginationHtml) {
                    paginationControlsContainer.innerHTML = paginationHtml;
                }
                safeCreateIcons();
            }
            
            function findParecerText(parecerKey) {
                for (const mainCategory in pareceresDataCorrigido) {
                    for (const subCategory in pareceresDataCorrigido[mainCategory]) {
                        if (typeof pareceresDataCorrigido[mainCategory][subCategory] === 'string' && subCategory === parecerKey) {
                             return pareceresDataCorrigido[mainCategory][subCategory];
                        }
                        if (typeof pareceresDataCorrigido[mainCategory][subCategory] === 'object') {
                            if (pareceresDataCorrigido[mainCategory][subCategory][parecerKey]) {
                                return pareceresDataCorrigido[mainCategory][subCategory][parecerKey];
                            }
                        }
                    }
                }
                return null;
            }


            // --- ESTADO INICIAL DA APLICAÇÃO ---
            function initializeApp() {
                updateThemeIcons();
                if (dockButtons.length > 0) {
                    requestAnimationFrame(() => {
                         dockButtons[0].click();
                    });
                }
            }

            // --- LÓGICA DO MODAL DE TERMOS ---
            const TERMS_KEY = 'apoioBpoTermsAccepted_v1.1';
            
            termsCheckbox.addEventListener('change', () => {
                acceptTermsBtn.disabled = !termsCheckbox.checked;
            });

            if (localStorage.getItem(TERMS_KEY) === 'true') {
                initializeApp();
            } else {
                termsModal.classList.remove('hidden');
                mainContent.classList.add('blurred');
                
                acceptTermsBtn.addEventListener('click', () => {
                    if (!termsCheckbox.checked) return;

                    localStorage.setItem(TERMS_KEY, 'true');
                    
                    termsModal.classList.add('animate-fade-out');
                    termsModal.addEventListener('animationend', () => {
                        termsModal.classList.add('hidden');
                    }, { once: true });

                    mainContent.classList.remove('blurred');
                    initializeApp();
                }, { once: true });
            }
        };
    </script>
</body>
</html>
