<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<!-- A classe 'dark' na tag <html> define o modo escuro como o padrão inicial -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP de Cálculos - UI/UX Aprimorado</title>

    <!-- Inclusão do Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fontes do Google (Poppins) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Biblioteca de Ícones (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 
      Configuração customizada do Tailwind e Estilos CSS.
    -->
    <style type="text/tailwindcss">
        /*
         * Definição das variáveis de cor para os temas.
         */
        :root {
            --color-bg: #e0e5ec;
            --color-text: #5a6474;
            --color-shadow-1: #ffffff;
            --color-shadow-2: #a3b1c6;
            --color-accent: #0ea5e9; /* Cor de destaque (Azul Céu 500) */
            --color-subtle: #9ca3af;
            --scrollbar-thumb: #a3b1c6;
            --scrollbar-thumb-hover: #5a6474;
        }

        html.dark {
            --color-bg: #1f2937;
            --color-text: #d1d9e6;
            --color-shadow-1: #374151;
            --color-shadow-2: #111827;
            --color-accent: #38bdf8; /* Cor de destaque (Azul Céu 400) */
            --color-subtle: #6b7280;
            --scrollbar-thumb: #5a6474;
            --scrollbar-thumb-hover: #9ca3af;
        }

        /* Estilo base do corpo da página usando as variáveis */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: background-color 0.35s cubic-bezier(0.4, 0, 0.2, 1), color 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: hidden;
        }

        /* Classes de utilidade para o Neumorfismo usando variáveis */
        .neumorphic-outset {
            box-shadow: 6px 6px 12px var(--color-shadow-2), -6px -6px 12px var(--color-shadow-1);
        }
        .neumorphic-inset {
            box-shadow: inset 6px 6px 12px var(--color-shadow-2), inset -6px -6px 12px var(--color-shadow-1);
        }
        .neumorphic-outset-sm {
            box-shadow: 3px 3px 6px var(--color-shadow-2), -3px -3px 6px var(--color-shadow-1);
        }
        
        /* Classe para a cor de destaque do texto */
        .text-accent {
            color: var(--color-accent);
        }
        .text-subtle {
            color: var(--color-subtle);
        }

        /* Estilização para o placeholder dos inputs */
        ::placeholder {
            color: #9ca3af;
        }
        .dark ::placeholder {
            color: #6b7280;
        }
        
        .copied-message {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .copied-message.show {
            opacity: 1;
        }

        /* Custom Scrollbar Styling */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: var(--scrollbar-thumb);
            border-radius: 20px;
            border: 2px solid var(--color-bg);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: var(--scrollbar-thumb-hover);
        }

        /* Toggle Switch */
        .toggle-checkbox:checked {
            transform: translateX(100%);
            background-color: var(--color-accent);
        }
        .toggle-label {
            background-color: #ccc;
        }
        html.dark .toggle-label {
             background-color: #4a5568;
        }
        html.dark .toggle-checkbox:checked + .toggle-label {
            background-color: var(--color-accent);
        }

        /* Animações simples */
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        @keyframes fade-out {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }
        .animate-fade-out {
            animation: fade-out 0.3s ease-in forwards;
        }
        
        /* Estilo para inputs e selects */
        input, select {
            background-color: transparent !important;
            color: var(--color-text);
        }
        select option {
            background: var(--color-bg);
            color: var(--color-text);
        }

    </style>
</head>

<!-- As classes de cor foram removidas do body, pois agora são controladas pelo CSS acima -->
<body>

    <!-- Container Principal: Centralizado e com largura máxima -->
    <div class="min-h-screen w-full flex flex-col items-center p-4 sm:p-8">

        <main class="w-full max-w-4xl mx-auto flex flex-col gap-4 mb-24">
            <!-- Cabeçalho da Aplicação -->
            <header class="flex justify-between items-center w-full px-2 flex-shrink-0">
                <h1 id="module-title" class="text-2xl font-bold transition-all duration-300">
                    <!-- O título será preenchido via JavaScript -->
                </h1>
                <button id="theme-toggle" class="p-3 rounded-full neumorphic-outset-sm transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">
                    <i data-lucide="sun" id="sun-icon"></i>
                    <i data-lucide="moon" id="moon-icon" class="hidden"></i>
                </button>
            </header>

            <!-- Container dos Módulos com altura flexível e sombra única -->
            <div id="module-container" class="w-full p-6 md:p-8 rounded-2xl neumorphic-outset">
                <!-- Módulo 1: Renda PJ (antigo Faturamento) -->
                <div id="faturamento-module" class="module-content hidden">
                    <form id="faturamento-form" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                        <!-- Linha 1 -->
                        <div class="flex flex-col gap-2">
                            <label for="rbt12" class="text-sm font-medium">Receita Bruta 12 Meses (RBT12)</label>
                            <input type="text" inputmode="decimal" id="rbt12" placeholder="0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                        </div>
                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-medium">1º Cálculo (Somente RBT12)</label>
                            <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                <p id="resultado1" class="text-2xl font-bold text-accent">R$ 0,00</p>
                            </div>
                        </div>

                        <!-- Linha 2 -->
                        <div class="flex flex-col gap-2">
                            <label for="rpa" class="text-sm font-medium">Receita Bruta do Período (RPA)</label>
                            <input type="text" inputmode="decimal" id="rpa" placeholder="0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                        </div>
                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-medium">2º Cálculo (+12 Meses)</label>
                            <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                <p id="resultado2" class="text-2xl font-bold text-accent">R$ 0,00</p>
                            </div>
                        </div>

                        <!-- Linha 3 -->
                        <div class="flex flex-col gap-2">
                            <label for="mes_anterior" class="text-sm font-medium">Redução Mês Ano Anterior</label>
                            <input type="text" inputmode="decimal" id="mes_anterior" placeholder="0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                        </div>
                         <div class="flex flex-col gap-2">
                            <label class="text-sm font-medium">3º Cálculo (&lt;12 Meses)</label>
                            <div class="p-4 rounded-2xl neumorphic-inset h-16 flex items-center">
                                <p id="resultado3" class="text-2xl font-bold text-accent">R$ 0,00</p>
                            </div>
                        </div>

                        <!-- Linha 4 -->
                        <div class="flex flex-col gap-2">
                            <label for="num_meses" class="text-sm font-medium">Quantidade de Meses (&lt; 12)</label>
                            <input type="number" id="num_meses" placeholder="1" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-16">
                        </div>
                        
                        <!-- Espaçador para alinhar o botão -->
                        <div></div>

                        <!-- Botões -->
                        <div class="md:col-span-2 flex gap-4 mt-4">
                            <button id="calcular-faturamento" type="button" class="flex-1 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                <i data-lucide="calculator" class="w-5 h-5"></i> Calcular
                            </button>
                            <button id="limpar-faturamento" type="button" class="flex-1 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                <i data-lucide="trash-2" class="w-5 h-5"></i> Limpar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Módulo 2: Renda PF -->
                <div id="renda-pf-module" class="module-content hidden">
                    <div class="flex mb-6 border-b border-slate-300 dark:border-slate-600 flex-shrink-0">
                        <button class="renda-pf-tab-button py-2 px-4 font-semibold" data-tab="calculadora">Calculadora</button>
                        <button class="renda-pf-tab-button py-2 px-4 font-semibold text-subtle" data-tab="media">Média de Holerites</button>
                        <button class="renda-pf-tab-button py-2 px-4 font-semibold text-subtle" data-tab="soma">Soma de Valores</button>
                    </div>
                    <div>
                        <div id="calculadora-tab" class="renda-pf-tab-content">
                           <h3 class="text-2xl font-bold mb-6">Calculadora Simples</h3>
                           <div class="flex flex-col gap-6">
                               <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 items-end">
                                   <input type="text" inputmode="decimal" id="valor_sisbr" placeholder="0,00" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm h-full">
                                   <div class="p-4 rounded-2xl neumorphic-inset">
                                       <p class="text-sm text-subtle uppercase tracking-wide">Multiplicado por 12</p>
                                       <p id="sisbr_mult" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                   </div>
                               </div>
                               <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 items-stretch">
                                   <button id="limpar_sisbr" type="button" class="h-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">Limpar</button>
                                   <div class="p-4 rounded-2xl neumorphic-inset">
                                       <p class="text-sm text-subtle uppercase tracking-wide">Dividido por 12</p>
                                       <p id="sisbr_div" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                   </div>
                               </div>
                           </div>
                        </div>
                        <div id="media-tab" class="renda-pf-tab-content hidden">
                            <h3 class="text-2xl font-bold mb-6">Média de Holerites</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                <div class="flex flex-col gap-4">
                                    <h4 class="text-sm text-subtle uppercase tracking-wide">Valores</h4>
                                    <input type="text" inputmode="decimal" placeholder="Valor 1" class="media-holerite-input w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    <input type="text" inputmode="decimal" placeholder="Valor 2" class="media-holerite-input w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    <input type="text" inputmode="decimal" placeholder="Valor 3" class="media-holerite-input w-full bg-transparent p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                </div>
                                <div class="flex flex-col gap-4">
                                    <h4 class="text-sm text-subtle uppercase tracking-wide">Resultado</h4>
                                    <div class="p-4 rounded-2xl neumorphic-inset">
                                        <p class="text-sm font-medium">Média dos Valores</p>
                                        <p id="media_resultado" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                    </div>
                                    <button id="limpar_media" type="button" class="mt-2 p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">Limpar</button>
                                </div>
                            </div>
                        </div>
                        <div id="soma-tab" class="renda-pf-tab-content hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                <div class="flex flex-col gap-2">
                                    <h4 class="text-sm text-subtle uppercase tracking-wide mb-2">Valores a Somar</h4>
                                    <div id="soma-inputs-container" class="flex flex-col gap-2">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="soma-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    </div>
                                </div>
                                <div class="flex flex-col gap-2">
                                    <h4 class="text-sm text-subtle uppercase tracking-wide mb-2">Valores a Subtrair</h4>
                                    <div id="sub-inputs-container" class="flex flex-col gap-2">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                        <input type="text" inputmode="decimal" placeholder="0,00" class="sub-valor-input w-full p-2 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                    </div>
                                </div>
                                <div class="md:col-span-2 flex flex-col md:flex-row gap-4 mt-4">
                                     <div class="flex-1 p-4 rounded-2xl neumorphic-inset">
                                         <p class="text-sm font-medium">Soma Total</p>
                                         <p id="soma_total_resultado" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                     </div>
                                     <div class="flex-1 p-4 rounded-2xl neumorphic-inset">
                                         <p class="text-sm font-medium">Divisão por 12</p>
                                         <p id="soma_div12_resultado" class="text-2xl font-bold text-accent mt-1">R$ 0,00</p>
                                     </div>
                                </div>
                                <div class="md:col-span-2 mt-4">
                                    <button id="limpar_soma" type="button" class="w-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5">Limpar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Módulo 3: Regras IRPF -->
                <div id="regras-module" class="module-content hidden">
                    <h2 class="text-2xl font-bold mb-6">Regras do Imposto de Renda</h2>
                    <div class="overflow-auto custom-scrollbar">
                        <table class="w-full text-left text-sm">
                            <thead class="border-b-2 border-slate-300 dark:border-slate-600 sticky top-0 bg-[var(--color-bg)]">
                                <tr>
                                    <th class="p-2">Item</th>
                                    <th class="p-2">Referência</th>
                                    <th class="p-2">Tipo de Renda Aceito</th>
                                </tr>
                            </thead>
                            <tbody id="regras-irpf-tbody">
                                <!-- Conteúdo inserido estaticamente -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Módulo 4: Consulta CNPJ -->
                <div id="cnpj-module" class="module-content hidden">
                    <h3 class="text-2xl font-bold mb-6">Consultar CNPJ</h3>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <input type="text" id="cnpj-input" placeholder="00.000.000/0000-00" class="flex-grow p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                        <button id="consultar-cnpj" class="p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                            <i data-lucide="search" class="w-5 h-5"></i> Consultar
                        </button>
                        <button id="limpar-cnpj" class="p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                            <i data-lucide="x" class="w-5 h-5"></i> Limpar
                        </button>
                    </div>
                    <div id="cnpj-results-container" class="mt-6">
                        <!-- Os resultados da consulta serão exibidos aqui -->
                    </div>
                </div>

                <!-- Módulo 5: Parecer -->
                <div id="parecer-module" class="module-content hidden flex flex-col">
                    <div class="flex flex-col sm:flex-row items-center mb-6 gap-4 flex-shrink-0">
                        <div class="relative flex-grow w-full">
                            <input type="text" id="searchInput" placeholder="Pesquisar pareceres por tipo ou descrição..." class="w-full p-3 pr-12 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                            <i data-lucide="search" class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-subtle"></i>
                        </div>
                        <div class="w-full sm:w-auto">
                            <select id="parecer-category-filter" class="w-full p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                                <!-- Opções de categoria serão inseridas aqui -->
                            </select>
                        </div>
                    </div>
                    <div id="pareceresContainer" class="space-y-4 overflow-y-auto custom-scrollbar flex-grow">
                        <!-- Conteúdo dos pareceres será inserido aqui -->
                    </div>
                </div>
                <!-- Módulo 6: Contador -->
                <div id="contador-module" class="module-content hidden h-full">
                     <div class="grid md:grid-cols-2 gap-8 items-center h-full">
                        <div id="counters-grid" class="grid grid-cols-1 sm:grid-cols-2 grid-rows-2 gap-6 h-full min-h-[300px]">
                           <!-- Contadores serão inseridos aqui -->
                        </div>
                        <div class="flex flex-col gap-6 p-6 rounded-2xl neumorphic-inset">
                            <h3 class="text-sm text-subtle uppercase tracking-wide">Settings</h3>
                            <div class="flex items-center justify-between">
                                <label for="timer-toggle" class="font-medium">Timer Mode</label>
                                <div class="relative inline-block w-12 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" name="toggle" id="timer-toggle" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                    <label for="timer-toggle" class="toggle-label block overflow-hidden h-7 rounded-full cursor-pointer"></label>
                                </div>
                            </div>
                            <div class="flex flex-col gap-2">
                                <label for="increment-by-input" class="text-sm font-medium">Increment By</label>
                                <input type="number" id="increment-by-input" value="1" class="w-full bg-transparent p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                            </div>
                            <div class="flex flex-col gap-2">
                                <label for="counter-start-input" class="text-sm font-medium">Start Value</label>
                                <input type="number" id="counter-start-input" value="0" class="w-full bg-transparent p-3 rounded-2xl neumorphic-inset focus:outline-none text-sm">
                            </div>
                             <button id="add-counter-btn" class="w-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                <i data-lucide="plus-circle" class="w-5 h-5"></i> Add Counter
                            </button>
                             <button id="contador-reset" class="w-full p-3 rounded-2xl neumorphic-outset-sm font-semibold tracking-wider uppercase transition-all duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center gap-2">
                                <i data-lucide="rotate-cw" class="w-5 h-5"></i> Reset All
                            </button>
                        </div>
                     </div>
                </div>
            </div>
        </main>

        <!-- Dock de Navegação Fixo -->
        <nav class="fixed bottom-0 left-0 right-0 p-4 w-full flex justify-center">
            <div id="dock-container" class="relative flex items-center justify-start sm:justify-center rounded-full neumorphic-outset overflow-x-auto max-w-full p-1">
                <div id="dock-slider" class="absolute top-0 bottom-0 rounded-full neumorphic-inset" style="transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);"></div>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="faturamento-module" data-title="Cálculo Renda PJ">Renda PJ</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="renda-pf-module" data-title="Cálculo Renda PF">Renda PF</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="cnpj-module" data-title="Consulta CNPJ">Consulta CNPJ</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="contador-module" data-title="Contador">Contador</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="regras-module" data-title="Regras IRPF">Regras</button>
                <button class="dock-button relative z-10 px-4 py-3 whitespace-nowrap text-sm" data-target="parecer-module" data-title="Pareceres">Pareceres</button>
            </div>
        </nav>
    </div>

    <template id="counter-template">
        <div class="counter-card p-4 rounded-2xl neumorphic-inset flex flex-col items-center justify-center gap-4 relative h-full">
            <button class="remove-counter-btn absolute top-2 right-2 p-1 rounded-full hover:bg-black/10 dark:hover:bg-white/10">
                <i data-lucide="x" class="w-4 h-4"></i>
            </button>
            <h4 class="counter-title font-semibold text-center w-full px-4 truncate" contenteditable="true">Contador</h4>
            <span class="counter-display font-bold text-7xl text-accent cursor-pointer" contenteditable="false">0</span>
            <div class="flex items-center gap-4">
                <button class="counter-minus w-16 h-16 rounded-2xl neumorphic-outset-sm text-3xl font-bold active:scale-95 transition-transform flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5">-</button>
                <button class="counter-plus w-16 h-16 rounded-2xl neumorphic-outset-sm text-3xl font-bold active:scale-95 transition-transform flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5">+</button>
                
                <button class="timer-play w-16 h-16 rounded-2xl neumorphic-outset-sm text-3xl font-bold active:scale-95 transition-transform flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5 hidden"><i data-lucide="play"></i></button>
                <button class="timer-reset w-16 h-16 rounded-2xl neumorphic-outset-sm text-3xl font-bold active:scale-95 transition-transform flex items-center justify-center hover:bg-black/5 dark:hover:bg-white/5 hidden"><i data-lucide="rotate-cw"></i></button>
            </div>
        </div>
    </template>

    <script>
        // --- FUNÇÕES GLOBAIS ---
        function copyParecer(text, messageElementId) {
            const messageElement = document.getElementById(messageElementId);
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = 0;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            messageElement.classList.add('show');
            setTimeout(() => {
                messageElement.classList.remove('show');
            }, 1500);
        }

        document.addEventListener('DOMContentLoaded', () => {
            // --- SELEÇÃO DOS ELEMENTOS DO DOM ---
            const themeToggleButton = document.getElementById('theme-toggle');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const dockContainer = document.getElementById('dock-container');
            const dockSlider = document.getElementById('dock-slider');
            const dockButtons = document.querySelectorAll('.dock-button');
            const moduleTitle = document.getElementById('module-title');
            const modules = document.querySelectorAll('.module-content');
            const moduleContainer = document.getElementById('module-container');

            // --- FUNÇÕES AUXILIARES ---
            function formatCurrency(value) {
                if (isNaN(value) || !isFinite(value)) {
                    return "R$ 0,00";
                }
                return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            }

            function parseLocalFloat(value) {
                return parseFloat(String(value).replace(/\./g, '').replace(',', '.')) || 0;
            }

            // --- LÓGICA DO MODO CLARO/ESCURO ---
            themeToggleButton.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                updateThemeIcons();
            });
            
            function updateThemeIcons() {
                const isDarkMode = document.documentElement.classList.contains('dark');
                sunIcon.classList.toggle('hidden', isDarkMode);
                moonIcon.classList.toggle('hidden', !isDarkMode);
                lucide.createIcons();
            }

            // --- LÓGICA DA NAVEGAÇÃO E MÓDULOS ---
            let currentModuleId = null;

            function updateSlider(button) {
                if (!button) return;
                dockSlider.style.width = `${button.offsetWidth}px`;
                dockSlider.style.left = `${button.offsetLeft}px`;
                dockButtons.forEach(btn => btn.classList.remove('text-accent', 'font-semibold'));
                button.classList.add('text-accent', 'font-semibold');
            }

            dockButtons.forEach((button, index) => {
                button.addEventListener('click', () => {
                    const targetModuleId = button.dataset.target;
                    if (targetModuleId === currentModuleId) return;
                    currentModuleId = targetModuleId;
                    
                    const targetTitle = button.dataset.title;
                    updateSlider(button);
                    moduleTitle.textContent = targetTitle;
                    
                    modules.forEach(module => module.classList.add('hidden'));
                    const activeModule = document.getElementById(targetModuleId);
                    if (activeModule) {
                       activeModule.classList.remove('hidden');
                       if (targetModuleId === 'regras-module') renderRegrasTable();
                       if (targetModuleId === 'parecer-module') {
                            populateParecerFilter();
                            filterPareceres();
                       }
                       if (targetModuleId === 'contador-module' && counters.length === 0) {
                           addCounterBtn.click();
                       }
                    }
                });
            });
            
            // --- LÓGICA DO MÓDULO DE FATURAMENTO ---
            const faturamentoForm = document.getElementById('faturamento-form');
            const faturamentoInputs = faturamentoForm.querySelectorAll('#faturamento-form input');
            
            document.getElementById('calcular-faturamento').addEventListener('click', () => {
                let allValid = true;
                faturamentoInputs.forEach(input => {
                    input.classList.remove('border-red-500');
                    if(input.value.trim() === '') {
                        input.classList.add('border', 'border-red-500');
                        allValid = false;
                    }
                });

                if (!allValid) return;

                const rbt12 = parseLocalFloat(document.getElementById('rbt12').value);
                const rpa = parseLocalFloat(document.getElementById('rpa').value);
                const mesAnterior = parseLocalFloat(document.getElementById('mes_anterior').value);
                const numMeses = parseInt(document.getElementById('num_meses').value) || 0;
                document.getElementById('resultado1').textContent = formatCurrency(rbt12 / 12);
                document.getElementById('resultado2').textContent = formatCurrency(((rbt12 + rpa) - mesAnterior) / 12);
                document.getElementById('resultado3').textContent = formatCurrency(numMeses > 0 ? (rpa + rbt12) / numMeses : 0);
            });
            document.getElementById('limpar-faturamento').addEventListener('click', () => {
                faturamentoForm.reset();
                 faturamentoInputs.forEach(input => input.classList.remove('border', 'border-red-500'));
                document.getElementById('resultado1').textContent = formatCurrency(0);
                document.getElementById('resultado2').textContent = formatCurrency(0);
                document.getElementById('resultado3').textContent = formatCurrency(0);
            });

            // --- LÓGICA DO MÓDULO RENDA PF (ABAS E CÁLCULOS) ---
            const rendaPfTabButtons = document.querySelectorAll('.renda-pf-tab-button');
            const rendaPfTabContents = document.querySelectorAll('.renda-pf-tab-content');
            rendaPfTabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTabId = `${button.dataset.tab}-tab`;
                    rendaPfTabButtons.forEach(btn => btn.classList.add('text-subtle'));
                    button.classList.remove('text-subtle');
                    rendaPfTabContents.forEach(content => {
                        content.classList.toggle('hidden', content.id !== targetTabId);
                    });
                });
            });

            // Aba 1: Calculadora SISBR
            const valorSisbrInput = document.getElementById('valor_sisbr');
            valorSisbrInput.addEventListener('input', () => {
                const valor = parseLocalFloat(valorSisbrInput.value);
                document.getElementById('sisbr_mult').textContent = formatCurrency(valor * 12);
                document.getElementById('sisbr_div').textContent = formatCurrency(valor / 12);
            });
            document.getElementById('limpar_sisbr').addEventListener('click', () => {
                valorSisbrInput.value = '';
                valorSisbrInput.dispatchEvent(new Event('input'));
            });

            // Aba 2: Média Holerites
            const mediaInputs = document.querySelectorAll('.media-holerite-input');
            const limparMediaBtn = document.getElementById('limpar_media');
            function calcularMedia() {
                let total = 0;
                let count = 0;
                mediaInputs.forEach(inp => {
                    const val = parseLocalFloat(inp.value);
                    if (!isNaN(val) && val > 0) {
                        total += val;
                        count++;
                    }
                });
                const media = count > 0 ? total / count : 0;
                document.getElementById('media_resultado').textContent = formatCurrency(media);
            }
            mediaInputs.forEach(input => input.addEventListener('input', calcularMedia));
            limparMediaBtn.addEventListener('click', () => {
                mediaInputs.forEach(input => input.value = '');
                calcularMedia();
            });

            // Aba 3: Soma de Valores
            const somaInputs = document.querySelectorAll('.soma-valor-input');
            const subInputs = document.querySelectorAll('.sub-valor-input');
            const limparSomaBtn = document.getElementById('limpar_soma');
            function calcularSomaTotal() {
                let totalSoma = 0;
                somaInputs.forEach(inp => totalSoma += parseLocalFloat(inp.value));
                let totalSub = 0;
                subInputs.forEach(inp => totalSub += parseLocalFloat(inp.value));
                const somaFinal = totalSoma - totalSub;
                document.getElementById('soma_total_resultado').textContent = formatCurrency(somaFinal);
                document.getElementById('soma_div12_resultado').textContent = formatCurrency(somaFinal / 12);
            }
            somaInputs.forEach(input => input.addEventListener('input', calcularSomaTotal));
            subInputs.forEach(input => input.addEventListener('input', calcularSomaTotal));
            limparSomaBtn.addEventListener('click', () => {
                somaInputs.forEach(input => input.value = '');
                subInputs.forEach(input => input.value = '');
                calcularSomaTotal();
            });

            // --- LÓGICA DO MÓDULO DE REGRAS (ABAS E FILTRO) ---
            const regrasTbody = document.getElementById('regras-irpf-tbody');
            
            function renderRegrasTable() {
                const regrasData = [
                    { item: '01', ref: 'Bolsa de estudo e de pesquisa', type: ['Outros', 'Bolsa de estudo', 'Bolsa do governo'] },
                    { item: '02', ref: 'Ganho de capital na alienação de bens', type: ['Outros'] },
                    { item: '03', ref: 'Capital das apólices de seguro', type: ['Outros'] },
                    { item: '04', ref: 'Indenizações por rescisão', type: ['Outros'] },
                    { item: '06', ref: 'Ganho de capital na alienação do único imóvel', type: ['Outros'] },
                    { item: '06', ref: 'Rendimentos de aplicações financeiras', type: ['Outros', 'Aplicação'] },
                    { item: '07', ref: 'Ganho de capital na venda de imóveis residenciais', type: ['Outros'] },
                    { item: '08', ref: 'Ganho de capital na alienação de moeda estrangeira', type: ['Outros'] },
                    { item: '09', ref: 'Lucros e dividendos recebidos', type: ['Outros', 'Pró-labore'] },
                    { item: '10', ref: 'Parcela isenta de proventos de aposentadoria', type: ['Aposentadoria'] },
                    { item: '10', ref: 'Juros sobre capital próprio', type: ['Outros'] },
                    { item: '11', ref: 'Participação nos lucros e dividendos', type: ['Outros'] },
                    { item: '11', ref: 'Pensão, proventos de aposentadoria por moléstia grave', type: ['Aposentadoria', 'Pensão alimentícia'] },
                    { item: '12', ref: 'Rendimentos de caderneta de poupança (LCA, LCI)', type: ['Outros', 'Aplicação'] },
                    { item: '13', ref: 'Rendimento de sócio ou titular de microempresa', type: ['Outros'] },
                    { item: '14', ref: 'Transferências patrimoniais - doações e heranças', type: ['Outros'] },
                    { item: '15', ref: 'Parcelas não tributáveis (atividade rural)', type: ['Agropecuária'] },
                    { item: '16', ref: 'Imposto sobre a renda de anos anteriores', type: ['Outros'] },
                    { item: '17', ref: 'Rendimento assalariado em moeda estrangeira', type: ['Salário e outros'] },
                    { item: '18', ref: 'Incorporações de reserva ao capital', type: ['Outros'] },
                    { item: '19', ref: 'Transferências patrimoniais', type: ['Outros'] },
                    { item: '20', ref: 'Ganhos líquidos de operações no mercado à vista', type: ['Outros', 'Aplicação'] },
                    { item: '21', ref: 'Ganhos com operações com ouro', type: ['Outros', 'Prestação de serviço'] },
                    { item: '22', ref: 'Recuperação de prejuízos em renda variável', type: ['Outros'] },
                    { item: '23', ref: 'Rendimento bruto, transporte de carga', type: ['Outros', 'Prestação de serviço'] },
                    { item: '24', ref: 'Rendimento bruto, transporte de passageiros', type: ['Outros', 'Prestação de serviço'] },
                    { item: '25', ref: 'Restituição do imposto de renda', type: ['Outros'] },
                    { item: '28', ref: 'Pensão alimentícia', type: ['Outros', 'Pensão alimentícia'] },
                    { item: '99', ref: 'Outros', type: ['Outros'] },
                ];
                regrasTbody.innerHTML = '';
                regrasData.forEach(regra => {
                    const row = `
                        <tr class="border-b border-slate-300 dark:border-slate-700">
                            <td class="p-2 font-semibold">${regra.item}</td>
                            <td class="p-2">${regra.ref}</td>
                            <td class="p-2">${regra.type.join(', ')}</td>
                        </tr>
                    `;
                    regrasTbody.innerHTML += row;
                });
            }

            // --- LÓGICA DO MÓDULO DE CONSULTA CNPJ ---
            const cnpjInput = document.getElementById('cnpj-input');
            const consultarCnpjBtn = document.getElementById('consultar-cnpj');
            const limparCnpjBtn = document.getElementById('limpar-cnpj');
            const cnpjResultsContainer = document.getElementById('cnpj-results-container');

            cnpjInput.addEventListener('input', (e) => {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
                e.target.value = value.slice(0, 18);
            });

            consultarCnpjBtn.addEventListener('click', async () => {
                const cnpj = cnpjInput.value.replace(/\D/g, '');
                if (cnpj.length !== 14) {
                    cnpjResultsContainer.innerHTML = `<div class="p-4 rounded-2xl neumorphic-inset text-center text-red-500">Por favor, insira um CNPJ válido.</div>`;
                    return;
                }

                cnpjResultsContainer.innerHTML = `<div class="p-4 rounded-2xl neumorphic-inset text-center">Consultando...</div>`;

                try {
                    const response = await fetch(`https://open.cnpja.com/office/${cnpj}`);
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => null);
                        let errorMessage = `Erro ${response.status}: Não foi possível consultar o CNPJ.`;
                        if (errorData && errorData.message) errorMessage = errorData.message;
                        else if (response.status === 404) errorMessage = "CNPJ não encontrado.";
                        throw new Error(errorMessage);
                    }
                    const data = await response.json();
                    displayCnpjResults(data);
                } catch (error) {
                    cnpjResultsContainer.innerHTML = `<div class="p-4 rounded-2xl neumorphic-inset text-center text-red-500">${error.message}</div>`;
                }
            });

            function displayCnpjResults(data) {
                const isSimples = data.company?.simples?.optant ? 'Sim' : 'Não';
                const isSimei = data.company?.simei?.optant ? 'Sim' : 'Não';
                const porteEmpresa = data.company?.size?.text || 'Não informado';
                const lastUpdated = data.updated ? new Date(data.updated).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'Não informado';
                
                let sociosHtml = '<p class="text-subtle">Nenhum sócio encontrado.</p>';
                if (data.company?.members && data.company.members.length > 0) {
                    sociosHtml = `<ul class="list-disc list-inside">${data.company.members.map(socio => `<li>${socio.person.name} <span class="text-subtle">(${socio.role?.text || 'Sócio'})</span></li>`).join('')}</ul>`;
                }

                const rawJsonHtml = `
                    <details class="mt-4">
                        <summary class="cursor-pointer font-semibold text-sm text-subtle">Ver resposta JSON completa</summary>
                        <pre class="mt-2 p-4 rounded-2xl neumorphic-inset text-xs overflow-auto custom-scrollbar"><code>${JSON.stringify(data, null, 2)}</code></pre>
                    </details>
                `;

                cnpjResultsContainer.innerHTML = `
                    <div class="space-y-4">
                        <div class="p-4 rounded-2xl neumorphic-inset">
                            <p class="text-sm text-subtle uppercase tracking-wide">Última Atualização</p>
                            <p class="font-semibold mt-1">${lastUpdated}</p>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Situação Cadastral</p>
                                <p class="text-lg font-bold text-accent mt-1">${data.status?.text || 'Não informado'}</p>
                            </div>
                             <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Porte da Empresa</p>
                                <p class="text-lg font-bold text-accent mt-1">${porteEmpresa}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Optante Simples</p>
                                <p class="text-lg font-bold text-accent mt-1">${isSimples}</p>
                            </div>
                            <div class="p-4 rounded-2xl neumorphic-inset">
                                <p class="text-sm text-subtle uppercase tracking-wide">Optante SIMEI</p>
                                <p class="text-lg font-bold text-accent mt-1">${isSimei}</p>
                            </div>
                        </div>
                        <div class="p-4 rounded-2xl neumorphic-inset">
                            <p class="text-sm text-subtle uppercase tracking-wide">Atividade Principal (CNAE)</p>
                            <p class="font-semibold mt-1">${data.mainActivity?.text || 'Não informado'}</p>
                        </div>
                        <div class="p-4 rounded-2xl neumorphic-inset">
                            <p class="text-sm text-subtle uppercase tracking-wide mb-2">Sócios</p>
                            <div class="font-semibold">${sociosHtml}</div>
                        </div>
                        ${rawJsonHtml}
                    </div>
                `;
            }

            limparCnpjBtn.addEventListener('click', () => {
                cnpjInput.value = '';
                cnpjResultsContainer.innerHTML = '';
            });

            // --- LÓGICA DO MÓDULO DE PARECERES ---
            const pareceresData = {
                 "Pareceres Gerais": {"DOCUMENTO ILEGÍVEL":"Quando não é possível a leitura, ou ainda, não se pode ter certeza sobre a informação específica que necessita de validação.","DOCUMENTO INVÁLIDO":"Documento em anexo não é válido para a comprovação do fluxo em específico.","PRAZO DE VALIDADE":"Solicitar o envio de um documento com prazo de validade adequado, conforme os requisitos específicos do fluxo.","CHAVES INCORRETAS":"Documentos em chaves trocadas ou erradas se aplicam aqui.","ASSINATURAS":"Assinaturas corrompidas, ilegíveis ou faltando (tanto assinaturas manuscritas quanto digitais), assinaturas híbridas se aplicam aqui.","VÍNCULO NÃO ENCONTRADO":"Não foi possível encontrar vínculo entre o associado e o terceiro informado no comprovante em anexo.","FALTA DE DOCUMENTO COMPROBATÓRIO":"Falta de documentos obrigatórios ou necessários para a validação do fluxo.","DESCRIÇÃO DIVERGENTE":"Descrição informada no fluxo não condiz com os comprovantes.","DOCUMENTO CORTADO / RASURADO":"Documento com dados e informações relevantes para o cadastro cortadas / rasurado.","EXCLUSÃO NÃO PERMITIDA":"Quando não é possível realizar a exclusão do fluxo.","CADASTRO DIVERGENTE DO COMPROVANTE EM ANEXO":"Quando as informações cadastradas são completamente divergentes do anexo / não foram atualizadas de acordo.","CAPTURA DE TELA":"Anexo de captura de tela como comprovante.","APROVAÇÃO SEM VALIDAÇÃO":"Não havia documentos na aba “NOVO”. Aprovado conforme documentação vigente."},
                "Fluxos de Fontes de Renda": {"Pareceres gerais de renda":{"RENDA MENSAL INVÁLIDA":"Quando existir uma renda incorreta, não condizendo com o comprovante apresentado.","TIPO DE RENDA":"Necessário ajuste do tipo de renda.","DIVISÃO DE RENDA MENSAL INCORRETA":"Renda mensal informada é divergente do tempo de faturamento encontrado do documento em anexo.","RENDA PROVENIENTE DE FONTES PAGADORES DIVERGENTES":"Quando é realizada a soma de duas fontes pagadoras diferentes."},"Pareceres de renda Agropecuária":{"RENDA NÃO É PROVENIENTE DE ATIVIDADE RURAL":"Quando a renda informada não corresponde ao tipo de atividade rural desempenhada.","DIVISÃO DE RENDA AGROPECUÁRIA INCORRETA":"Quando a renda agropecuária não está corretamente dividida entre os membros da composição familiar ou grupo familiar.","LAUDO DE PRODUÇÃO AGROPECUÁRIA":"Ajuste necessário no laudo de produção.","RENDA EFETIVA SOMADA COM PREVISÃO":"Ajuste necessário quando é somada renda agropecuária de previsão com a efetiva."},"Pareceres de renda, SIMPLES":{"COMPROVANTE DO SIMPLES NACIONAL":"Solicitar o ajuste do documento referente ao SIMPLES.","CONSULTA DE OPÇÃO DO SIMPLES":"Falta da consulta de opção do simples em sua chave adequada / ajuste na consulta.","CAMPO DE OPTANTE DO SIMPLES":"Solicitar ajuste da opção do simples nacional no SIRBR.","CÁLCULO DO SIMPLES":"Quando o cálculo do faturamento do Simples não está correto ou não foi feito de acordo com a regra."},"Pareceres de renda, pessoa física":{"PRÓ-LABORE ACIMA DO LIMITE":"Quando o documento pró-labore anexado, em caso de MEI, ultrapassa os R$ 6.750,00.","RENDA DE TERCEIRO":"Quando associado usa um documento de renda em nome de outra pessoa.","RENDA INFORMADA NÃO RECORRENTE":"Valor somado ou declarado no cadastro não é considerado recorrente."}},
                "Fluxos de Pessoa": {"Pareceres gerais de pessoa":{"TIPO DE DOCUMENTO":"Tipo de documento informado diferente do comprovante.","NÚMERO DO DOCUMENTO":"Número do documento incorreto ou não registrado corretamente.","DATA DE EMISSÃO":"A data de emissão do documento não corresponde ao esperado ou não é válida.","FICHA CADASTRAL":"Falta de preenchimento correto na ficha cadastral.","FICHA PEP":"Falta de preenchimento correto na ficha PEP.","UF DO ORGAO EXPEDIDOR":"A UF do documento não corresponde"},"Pareceres de pessoa física":{"ESTADO CIVIL":"Divergência do documento com o estado civil declarado no SISBR.","ÓRGÃO EXPEDIDOR":"Órgão expedidor incorreto ou não informado.","NATURALIDADE":"Naturalidade do documento está diferente do SISBR."},"Pareceres de pessoa jurídica":{"DATA DE CONSTITUIÇÃO":"Data de constituição inválida ou fora do esperado.","NÚMERO DE REGISTRO NO ÓRGÃO COMPETENTE":"Número de registro inválido ou não existe.","NÚMERO DA ÚLTIMA ALTERAÇÃO DO CONTRATO SOCIAL":"Falta de número da última alteração do contrato social.","DATA DA ÚLTIMA ALTERAÇÃO DO CONTRATO SOCIAL":"Data de alteração do contrato social incorreta ou não atualizada.","NÚMERO DE REGISTRO DE REPRESENTAÇÃO":"Falta de número de registro de representação.","DATA DE REGISTRO REPRESENTAÇÃO":"Falta de data de registro de representação.","OPÇÃO MEI":"Necessário ajuste na opção do campo MEI.","NÚMERO DO CONTRATO SOCIAL":"Número do contrato social não registrado corretamente ou faltando.","CAPITAL SOCIAL":"Valor do capital social incorreto ou não condizente com o contrato social.","INSCRIÇÃO ESTADUAL":"Inscrição estadual incorreta ou não registrada corretamente.","DATA DE REGISTRO NO ÓRGÃO COMPETENTE":"Data de registro do órgão competente inconsistente."}},
                "Fluxos de Endereço": {"TIPO DE ENDEREÇO":"Tipo de endereço não especificado corretamente.","LOGRADOURO":"Nome do logradouro incorreto ou incompleto.","NÚMERO":"Número do imóvel faltando ou incorreto."},
                "Fluxos de Relacionamento": {"Pareceres gerais de relacionamento":{"TIPO DE RELACIONAMENTO":"Tipo de relacionamento não condiz com a documentação fornecida.","DATA DE INÍCIO DO MANDATO":"Data de início do mandato inválida ou não condiz com o documento.","DATA DE FIM DO MANDATO":"Data de fim do mandato incorreta ou não compatível com o documento.","NÚMERO DO REGISTRO":"Falta de número de registro.","NÚMERO DO LIVRO":"Falta de número do livro.","NÚMERO DA FOLHA":"Falta de número da folha.","NOME DO CARTÓRIO":"Falta de nome do cartório."},"Pareceres de relacionamento, pessoa jurídica":{"PERCENTUAL NO CAPITAL SOCIAL":"Percentual informado incorreto ou inconsistente."}},
                "Fluxos de Bem": {"Pareceres gerais de bem":{"TIPO DO BEM":"Tipo de bem não informado ou incorreto.","VALOR DE AVALIAÇÃO":"Valor de avaliação incorreto ou não condizente com o laudo.","ÁREA DIVERGENTE":"Área divergente do que foi documentado.","DATA DE AVALIAÇÃO":"Data da avaliação não corresponde à data do laudo.","VALOR DO BEM":"O valor informado não está correto, de acordo com a documentação.","DESCRIÇÃO DO BEM":"Descrição do bem não condiz com o tipo de bem ou está incompleta.","BEM EM PROCESSO DE AQUISIÇÃO":"Tentativa de cadastro de bem em aquisição como se fosse de posse plena.","BEM NÃO COMPROVADO COMO PATRIMÔNIO":"Bem-informado não é patrimônio do indivíduo ou da empresa.","LAUDO DE AVALIAÇÃO":"Laudo de avaliação não está válido ou não corresponde ao bem-informado.","PERCENTUAL DE PROPRIEDADE":"Percentual de propriedade do bem não informado ou incorreto.","CADASTRO DE BENS EM CONJUNTO":"Bens informados em conjunto quando deveriam ser cadastrados separadamente.","EXCLUSÃO DE BEM":"Por se tratar de exclusão, o percentual deve ser zerado.","EMPREENDIMENTO NÃO É VÁLIDO COMO BEM":"Empreendimentos não são aceitos como bens."},"Pareceres de Bens Móveis":{"TIPO DO CHASSI":"Tipo de chassi incorreto.","NÚMERO DO CHASSI":"Número do chassi inválido ou não registrado corretamente.","RENAVAM":"Número do RENAVAM incorreto ou não correspondente ao veículo.","PLACA":"Placa do veículo inválida ou não registrada corretamente.","ANO DE FABRICAÇÃO":"Ano de fabricação informado incorreto.","ANO MODELO":"Ano modelo não corresponde ao veículo registrado."},"Pareceres de Bens Imóveis":{"ÁREA DIVERGENTE":"Área divergente do que foi documentado.","UNIDADE DE MEDIDA":"Unidade de medida não está coerente com o documento."},"Pareceres de Bens Agropecuários":{"QUANTIDADE DE SEMOVENTES DIVERGENTE":"Número informado de semoventes divergente do comprovante.","PERCENTUAL DE ARRENDAMENTO":"Percentual de arrendamento não informado ou incorreto.","DESCRIÇÃO DE SEMOVENTES DIFERENTE DO DOCUMENTO":"Tipo de semovente está diferente do documento."}}
            };

            const searchInput = document.getElementById('searchInput');
            const parecerCategoryFilter = document.getElementById('parecer-category-filter');
            const pareceresContainer = document.getElementById('pareceresContainer');

            function populateParecerFilter() {
                parecerCategoryFilter.innerHTML = '<option value="all">Todas as Categorias</option>';
                for (const mainCategory in pareceresData) {
                    parecerCategoryFilter.innerHTML += `<option value="${mainCategory}">${mainCategory}</option>`;
                }
            }

            function renderPareceres(data) {
                pareceresContainer.innerHTML = '';
                let hasResults = false;

                function createParecerHTML(key, value, mainCategory, subCategory) {
                    hasResults = true;
                    const uniqueId = `copiedMessage-${mainCategory.replace(/\s/g, '-')}-${subCategory.replace(/\s/g, '-')}-${key.replace(/\s/g, '-')}`;
                    const fullParecerText = `${key}: ${value}`;
                    return `
                        <div class="p-4 rounded-2xl neumorphic-inset flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <h5 class="font-semibold mb-1">${key}</h5>
                                <p class="text-sm whitespace-normal break-words text-subtle">${value}</p>
                            </div>
                            <div class="flex-shrink-0 flex items-center self-start sm:self-center">
                                <button class="p-2 rounded-2xl neumorphic-outset-sm text-sm font-bold transition duration-200 active:scale-95 hover:bg-black/5 dark:hover:bg-white/5"
                                        onclick="copyParecer(decodeURIComponent('${encodeURIComponent(fullParecerText)}'), '${uniqueId}')">
                                    Copiar
                                </button>
                                <span id="${uniqueId}" class="copied-message text-sm text-green-500 ml-2">Copiado!</span>
                            </div>
                        </div>
                    `;
                }

                for (const mainCategory in data) {
                    const subCategories = data[mainCategory];
                    let mainCategoryHtml = `<h3 class="text-2xl font-bold mb-4 border-b-2 border-slate-300 dark:border-slate-600 pb-2">${mainCategory}</h3>`;
                    let contentHtml = '<div class="space-y-4">';

                    for (const subCategoryTitle in subCategories) {
                        const items = subCategories[subCategoryTitle];
                        if (typeof items === 'object' && items !== null) {
                            contentHtml += `<h4 class="text-xl font-semibold mb-3 mt-4">${subCategoryTitle}</h4>`;
                            for (const key in items) {
                                contentHtml += createParecerHTML(key, items[key], mainCategory, subCategoryTitle);
                            }
                        } else {
                            contentHtml += createParecerHTML(subCategoryTitle, items, mainCategory, '');
                        }
                    }
                    contentHtml += '</div>';
                    if (hasResults) {
                        pareceresContainer.innerHTML += mainCategoryHtml + contentHtml;
                    }
                }

                if (!hasResults) {
                    pareceresContainer.innerHTML = `
                        <div class="text-center text-lg py-8 text-subtle">
                            Nenhum parecer encontrado para a sua pesquisa.
                        </div>
                    `;
                }
                 lucide.createIcons();
            }
            
            function filterPareceres() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCategory = parecerCategoryFilter.value;
                
                const sourceData = selectedCategory === 'all' 
                    ? pareceresData 
                    : { [selectedCategory]: pareceresData[selectedCategory] };

                const filteredData = {};
                for (const mainCategory in sourceData) {
                    const subCategories = sourceData[mainCategory];
                    const filteredSubCategories = {};
                    for (const subCategoryTitle in subCategories) {
                        const items = subCategories[subCategoryTitle];
                        if (typeof items === 'object' && items !== null) {
                            const filteredItems = {};
                            for(const key in items) {
                                if (key.toLowerCase().includes(searchTerm) || items[key].toLowerCase().includes(searchTerm)) {
                                    filteredItems[key] = items[key];
                                }
                            }
                            if(Object.keys(filteredItems).length > 0) {
                                filteredSubCategories[subCategoryTitle] = filteredItems;
                            }
                        } else {
                            if (subCategoryTitle.toLowerCase().includes(searchTerm) || items.toLowerCase().includes(searchTerm)) {
                                filteredSubCategories[subCategoryTitle] = items;
                            }
                        }
                    }
                    if (Object.keys(filteredSubCategories).length > 0) {
                        filteredData[mainCategory] = filteredSubCategories;
                    }
                }
                renderPareceres(filteredData);
            }

            searchInput.addEventListener('input', filterPareceres);
            parecerCategoryFilter.addEventListener('change', filterPareceres);

            // --- LÓGICA DO MÓDULO CONTADOR ---
            const countersGrid = document.getElementById('counters-grid');
            const addCounterBtn = document.getElementById('add-counter-btn');
            const counterTemplate = document.getElementById('counter-template');
            const incrementInput = document.getElementById('increment-by-input');
            const startInput = document.getElementById('counter-start-input');
            const timerToggle = document.getElementById('timer-toggle');
            const resetAllBtn = document.getElementById('contador-reset');

            let counters = [];

            function updateCountersLayout() {
                const count = counters.length;
                const cards = countersGrid.querySelectorAll('.counter-card');
                cards.forEach(card => {
                    card.classList.remove('sm:col-span-2', 'sm:row-span-2');
                });
                
                if (count === 1) {
                    cards[0].classList.add('sm:col-span-2', 'sm:row-span-2');
                } else if (count === 2) {
                    cards.forEach(card => card.classList.add('sm:row-span-2'));
                } else if (count === 3) {
                    cards[2].classList.add('sm:col-span-2');
                }
            }

            function createCounterInstance(id, initialValue, isTimer) {
                const counterElement = counterTemplate.content.cloneNode(true).firstElementChild;
                counterElement.dataset.id = id;
                
                const titleElement = counterElement.querySelector('.counter-title');
                const display = counterElement.querySelector('.counter-display');
                const plusBtn = counterElement.querySelector('.counter-plus');
                const minusBtn = counterElement.querySelector('.counter-minus');
                const removeBtn = counterElement.querySelector('.remove-counter-btn');
                const playBtn = counterElement.querySelector('.timer-play');
                const resetBtn = counterElement.querySelector('.timer-reset');

                if (isTimer) {
                    titleElement.textContent = `Timer ${counters.length + 1}`;
                } else {
                    titleElement.textContent = `Contador ${counters.length + 1}`;
                }

                let value = initialValue;
                let timerInterval = null;
                let initialTimerValue = initialValue;

                const instance = {
                    id, element: counterElement,
                    updateDisplay() {
                        if (isTimer) {
                            const minutes = Math.floor(value / 60).toString().padStart(2, '0');
                            const seconds = (value % 60).toString().padStart(2, '0');
                            display.textContent = `${minutes}:${seconds}`;
                        } else {
                            display.textContent = value;
                        }
                    },
                    remove() {
                        clearInterval(timerInterval);
                        counterElement.classList.add('animate-fade-out');
                        counterElement.addEventListener('animationend', () => {
                            counterElement.remove();
                            counters = counters.filter(c => c.id !== id);
                            updateCountersLayout();
                        }, { once: true });
                    }
                };
                
                removeBtn.addEventListener('click', instance.remove);

                if (isTimer) {
                    display.setAttribute('contenteditable', true);
                    plusBtn.classList.add('hidden');
                    minusBtn.classList.add('hidden');
                    playBtn.classList.remove('hidden');
                    resetBtn.classList.remove('hidden');

                    display.addEventListener('blur', () => {
                        const parts = display.textContent.split(':').map(part => parseInt(part) || 0);
                        value = (parts.length === 2) ? (parts[0] * 60) + parts[1] : parts[0];
                        initialTimerValue = value;
                        instance.updateDisplay();
                    });

                    playBtn.addEventListener('click', () => {
                        if (timerInterval) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                            playBtn.innerHTML = '<i data-lucide="play"></i>';
                        } else if (value > 0) {
                            playBtn.innerHTML = '<i data-lucide="pause"></i>';
                            timerInterval = setInterval(() => {
                                value--;
                                instance.updateDisplay();
                                if (value <= 0) {
                                    clearInterval(timerInterval);
                                    timerInterval = null;
                                    playBtn.innerHTML = '<i data-lucide="play"></i>';
                                }
                            }, 1000);
                        }
                        lucide.createIcons();
                    });

                    resetBtn.addEventListener('click', () => {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        value = initialTimerValue;
                        playBtn.innerHTML = '<i data-lucide="play"></i>';
                        lucide.createIcons();
                        instance.updateDisplay();
                    });

                } else {
                    plusBtn.addEventListener('click', () => {
                        value += parseInt(incrementInput.value) || 1;
                        instance.updateDisplay();
                    });
                    minusBtn.addEventListener('click', () => {
                        value -= parseInt(incrementInput.value) || 1;
                        instance.updateDisplay();
                    });
                }
                
                instance.updateDisplay();
                counters.push(instance);
                countersGrid.appendChild(counterElement);
                lucide.createIcons({nodes: [counterElement]});
                counterElement.classList.add('animate-fade-in');
            }

            addCounterBtn.addEventListener('click', () => {
                if (counters.length >= 4) return;
                const initialValue = parseInt(startInput.value) || 0;
                const isTimer = timerToggle.checked;
                createCounterInstance(Date.now(), initialValue, isTimer);
                updateCountersLayout();
            });
            
            resetAllBtn.addEventListener('click', () => {
                const startValue = parseInt(startInput.value) || 0;
                counters.forEach(counter => {
                    clearInterval(counter.timerInterval);
                    counter.timerInterval = null;
                    counter.value = startValue;
                    counter.updateDisplay();
                });
            });


            // --- ESTADO INICIAL DA APLICAÇÃO ---
            function initializeApp() {
                updateThemeIcons();
                if (dockButtons.length > 0) {
                    requestAnimationFrame(() => {
                         dockButtons[0].click();
                    });
                }
            }

            initializeApp();
        });
    </script>
</body>
</html>
